<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>üìà Candlestick Library ‚Äì ‡∏£‡∏ß‡∏°‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô + ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</title>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">
<!-- PapaParse -->
<script src="https://unpkg.com/papaparse@5.4.1/papaparse.min.js"></script>

<style>
  :root{
    --bg:#0f172a;
    --paper:#ffffff;
    --ink:#0f172a;
    --muted:#475569;
    --line:#e2e8f0;
    --brand:#0f766e;
    --radius:16px;
    --shadow:0 16px 40px -22px rgba(15,23,42,.25);
  }
  *{box-sizing:border-box}
  body{
    margin:0;
    font-family:"Sarabun",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
    background:linear-gradient(180deg,#0f172a 0%, #0f172a 180px, #e2e8f0 180px, #e2e8f0 100%);
    color:var(--ink);
  }

  header{
    position:sticky; top:0; z-index:50;
    background:rgba(15,23,42,.85);
    backdrop-filter:blur(8px);
    color:#fff; padding:14px 16px; box-shadow:0 10px 30px -20px rgba(0,0,0,.4)
  }
  header .wrap{
    max-width:980px; margin:auto; display:flex; gap:12px; align-items:center; flex-wrap:wrap
  }
  .title{font-weight:700; font-size:1.25rem}
  .search{
    margin-left:auto; display:flex; align-items:center; gap:8px;
    background:rgba(255,255,255,.12); padding:6px 10px; border-radius:999px; width:min(420px,100%)
  }
  .search input{border:none; outline:none; background:transparent; color:#fff; width:100%}
  .search ::placeholder{color:rgba(255,255,255,.75)}

  .filepick{
    display:flex; gap:6px; align-items:center;
    background:rgba(255,255,255,.08);
    border:1px solid rgba(255,255,255,.05);
    border-radius:999px; padding:4px 10px;
    font-size:.78rem;
  }
  .filepick input{display:none;}
  .filepick label{cursor:pointer;}

  .layout{max-width:980px; margin:14px auto 30px; padding:0 16px}
  #candles{
    background:var(--paper); border-radius:var(--radius); box-shadow:var(--shadow);
    border:1px solid rgba(15,118,110,.08);
    padding:14px;
  }
  .card{
    display:grid; grid-template-columns:82px 1fr; gap:12px;
    border:1px solid var(--line); border-radius:14px;
    margin:10px 0; background:#fff; cursor:pointer;
    transition:transform .12s ease, box-shadow .12s ease;
  }
  .card:hover{transform:translateY(-2px); box-shadow:0 16px 30px -20px rgba(15,23,42,.2)}
  .thumb{
    width:100%; height:70px; border-radius:10px; object-fit:contain;
    background:#e2e8f0;
  }
  .c-name{font-weight:700; color:#0f172a}
  .c-meta{color:var(--muted); font-size:.75rem}
  .tag{display:inline-block; background:#ecfdf3; border:1px solid #bbf7d0; color:#166534; font-size:.7rem; padding:3px 8px; border-radius:999px; margin-top:4px}
  .tag.red{background:#fef2f2; border-color:#fecaca; color:#b91c1c}
  .tag.blue{background:#eff6ff; border-color:#dbeafe; color:#1d4ed8}

  .pager{display:flex; justify-content:center; gap:8px; margin-top:8px}
  .pager .btn{
    border:1px solid var(--line); background:#fff; border-radius:10px; padding:5px 10px; cursor:pointer
  }
  .pager .btn[disabled]{opacity:.5; cursor:not-allowed}
  .pager .info{font-size:.85rem; color:#475569; padding:3px 0}

  dialog{
    width:min(880px, 94vw); border:none; border-radius:20px; overflow:hidden;
    box-shadow:0 30px 70px -20px rgba(15,23,42,.5);
  }
  .modal-head{
    display:flex; gap:12px; align-items:center; padding:14px 16px;
    background:#0f172a; color:#fff;
  }
  .modal-body{
    background:#fff; padding:16px; display:grid; grid-template-columns:280px 1fr; gap:16px;
  }
  .modal-body img{width:100%; border-radius:16px; border:1px solid #e2e8f0; background:#f8fafc; height:180px; object-fit:contain}
  .close-btn{
    margin-left:auto; background:#fff; color:#0f172a; border:none; border-radius:999px; padding:6px 14px; cursor:pointer; font-weight:600
  }
  pre.tip{
    background:#f8fafc; border:1px solid #e2e8f0; border-radius:14px; padding:8px 10px; font-size:.78rem; line-height:1.5; white-space:pre-wrap
  }

  @media (max-width:620px){
    .card{grid-template-columns:68px 1fr}
    .thumb{height:64px}
    .modal-body{grid-template-columns:1fr}
  }
</style>
</head>
<body>

<header>
  <div class="wrap">
    <div class="title">üìà Candlestick Library ‚Äì ‡∏î‡∏π‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô + ‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ</div>
    <div class="search">
      <svg width="18" height="18" viewBox="0 0 24 24" fill="none"><path d="M21 21l-4.35-4.35M10.5 18a7.5 7.5 0 1 1 0-15 7.5 7.5 0 0 1 0 15Z" stroke="white" stroke-width="2" stroke-linecap="round"/></svg>
      <input id="q" type="search" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤: bullish / bearish / engulfing / ‡∏î‡∏≤‡∏ß‡∏ï‡∏Å / 3 ‡∏ï‡∏±‡∏ß / 2 ‡πÅ‡∏ó‡πà‡∏á ...">
    </div>
    <div class="filepick">
      <label for="csvFile">üìÅ ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å CSV</label>
      <span id="fileName" style="opacity:.7">‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å</span>
      <input type="file" id="csvFile" accept=".csv">
    </div>
  </div>
</header>

<div class="layout">
  <section id="candles" aria-label="candlestick patterns"></section>
  <div id="pager" class="pager"></div>
</div>

<!-- Modal -->
<dialog id="detailModal">
  <div class="modal-head">
    <h3 id="mTitle">Candlestick</h3>
    <button class="close-btn" onclick="modal.close()">‡∏õ‡∏¥‡∏î</button>
  </div>
  <div class="modal-body">
    <img id="mImg" alt="">
    <div>
      <div id="mMeta" class="c-meta"></div>
      <p style="margin:.1rem 0 .4rem;font-weight:700">‡∏Ñ‡∏≥‡∏≠‡∏ò‡∏¥‡∏ö‡∏≤‡∏¢</p>
      <div id="mSummary" style="line-height:1.7"></div>
      <p style="margin:.6rem 0 .4rem;font-weight:700">‡πÄ‡∏ó‡∏Ñ‡∏ô‡∏¥‡∏Ñ‡∏Å‡∏≤‡∏£‡πÉ‡∏ä‡πâ</p>
      <pre id="mTip" class="tip"></pre>
    </div>
  </div>
  <div class="modal-footer" style="background:#fff;border-top:1px solid #e2e8f0;padding:15px 16px">
    <a id="mSource" class="btn-primary" target="_blank" rel="noopener"
       style="background:#0f766e;color:#fff;border-radius:12px;padding:10px 14px;text-decoration:none;font-weight:600;display:inline-block">
       ‡∏î‡∏π‡∏ï‡∏±‡∏ß‡∏≠‡∏¢‡πà‡∏≤‡∏á‡∏Å‡∏£‡∏≤‡∏ü
    </a>
  </div>
</dialog>

<script>
const SHEET_CSV_URL = "candlestick_100_images.csv"; // ‡∏ä‡∏∑‡πà‡∏≠‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ö index.html
let RAW = [];
let CURRENT = [];
let page = 1;
const pageSize = 20;
const PLACEHOLDER = "https://placehold.co/240x160?text=Candle";

// ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å URL ‡∏õ‡∏Å‡∏ï‡∏¥ (‡πÉ‡∏ä‡πâ‡πÑ‡∏î‡πâ‡∏ï‡∏≠‡∏ô‡πÄ‡∏õ‡∏¥‡∏î‡∏ú‡πà‡∏≤‡∏ô server ‡∏´‡∏£‡∏∑‡∏≠‡πÇ‡∏Æ‡∏™‡∏ï‡πå)
async function loadCSVFromUrl(){
  return new Promise((resolve, reject)=>{
    Papa.parse(SHEET_CSV_URL, {
      download:true,
      header:true,
      skipEmptyLines:true,
      complete: res => resolve(res.data),
      error: reject
    });
  });
}

// ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà user ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å
function loadCSVFromFile(file){
  return new Promise((resolve, reject)=>{
    Papa.parse(file, {
      header:true,
      skipEmptyLines:true,
      complete: res => resolve(res.data),
      error: reject
    });
  });
}

// ‡∏ï‡∏±‡∏î‡∏ä‡πà‡∏≠‡∏á‡∏ß‡πà‡∏≤‡∏á/‡∏ï‡∏±‡∏ß‡πÄ‡∏ß‡πâ‡∏ô‡∏ß‡∏£‡∏£‡∏Ñ‡∏ó‡∏µ‡πà‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡∏£‡∏π‡∏õ‡πÇ‡∏´‡∏•‡∏î‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ
function cleanUrl(u){
  if(!u) return "";
  return String(u).trim().replace(/\s+/g, "");
}

function applyFilters(){
  const q = document.getElementById('q').value.trim().toLowerCase();
  CURRENT = RAW.filter(r=>{
    const hay = `${r.name||""} ${r.side||""} ${r.grouping||""} ${r.summary||""} ${r.tip||""}`.toLowerCase();
    return q==="" ? true : hay.includes(q);
  });
  page = 1;
  renderList();
}

function renderList(){
  const host = document.getElementById('candles');
  host.innerHTML = "";
  if (CURRENT.length === 0){
    host.innerHTML = `<div style="padding:10px;color:#475569">‡πÑ‡∏°‡πà‡∏û‡∏ö‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö‡πÅ‡∏ó‡πà‡∏á‡πÄ‡∏ó‡∏µ‡∏¢‡∏ô‡∏ó‡∏µ‡πà‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤</div>`;
    document.getElementById('pager').innerHTML = "";
    return;
  }

  const totalPages = Math.ceil(CURRENT.length / pageSize);
  page = Math.min(page, totalPages);
  const start = (page - 1) * pageSize;
  const end = start + pageSize;
  const slice = CURRENT.slice(start, end);

  slice.forEach(r=>{
    const card = document.createElement('article');
    card.className = 'card';

    const img = document.createElement('img');
    img.className = 'thumb';
    img.loading = 'lazy';
    const imgUrl = cleanUrl(r.image);
    img.src = imgUrl || PLACEHOLDER;
    img.onerror = ()=>{ img.src = PLACEHOLDER; };

    const right = document.createElement('div');
    const tagColor = r.side === "Bearish" ? " red" : (r.side === "Bullish" ? "" : "");
    right.innerHTML = `
      <div class="c-name">${r.name||""}</div>
      <div class="c-meta">${r.grouping||""} ‚Ä¢ ${r.side||""} ‚Ä¢ ${r.count ? (r.count + " ‡πÅ‡∏ó‡πà‡∏á") : ""}</div>
      <span class="tag${tagColor}">${r.side||"Pattern"}</span>
      ${r.grouping ? `<span class="tag blue">${r.grouping}</span>` : ""}
    `;

    card.append(img, right);
    card.addEventListener('click', ()=>openModal(r));
    host.append(card);
  });

  // pager
  const pager = document.getElementById('pager');
  pager.innerHTML = "";
  const total = CURRENT.length;

  const btnPrev = document.createElement('button');
  btnPrev.textContent = '‡∏¢‡πâ‡∏≠‡∏ô‡∏Å‡∏•‡∏±‡∏ö';
  btnPrev.className = 'btn';
  btnPrev.disabled = page <= 1;
  btnPrev.onclick = ()=>{ page = Math.max(1, page-1); renderList(); };

  const info = document.createElement('span');
  info.className = 'info';
  info.textContent = `${start+1}-${Math.min(end,total)} / ${total} ‡∏£‡∏π‡∏õ‡πÅ‡∏ö‡∏ö`;

  const btnNext = document.createElement('button');
  btnNext.textContent = '‡∏ñ‡∏±‡∏î‡πÑ‡∏õ';
  btnNext.className = 'btn';
  btnNext.disabled = page >= totalPages;
  btnNext.onclick = ()=>{ page = Math.min(totalPages, page+1); renderList(); };

  pager.append(btnPrev, info, btnNext);
}

const modal = document.getElementById('detailModal');
function openModal(r){
  const imgUrl = cleanUrl(r.image);
  document.getElementById('mTitle').textContent = r.name || "";
  const modalImg = document.getElementById('mImg');
  modalImg.src = imgUrl || PLACEHOLDER;
  modalImg.onerror = ()=>{ modalImg.src = PLACEHOLDER; };

  document.getElementById('mMeta').textContent = `${r.side||""} ‚Ä¢ ${r.grouping||""} ‚Ä¢ ${r.count ? r.count + " ‡πÅ‡∏ó‡πà‡∏á" : ""}`;
  document.getElementById('mSummary').textContent = r.summary || "";
  document.getElementById('mTip').textContent = r.tip || "‡πÉ‡∏ä‡πâ‡∏£‡πà‡∏ß‡∏°‡∏Å‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏£‡∏±‡∏ö‡πÅ‡∏ô‡∏ß‡∏ï‡πâ‡∏≤‡∏ô‡πÅ‡∏•‡∏∞‡∏ß‡∏≠‡∏•‡∏∏‡πà‡∏°‡∏à‡∏∞‡∏ä‡∏±‡∏î‡∏Ç‡∏∂‡πâ‡∏ô";

  const src = document.getElementById('mSource');
  if (r.source_url){
    src.href = r.source_url;
    src.style.display = 'inline-block';
  } else {
    src.style.display = 'none';
  }
  modal.showModal();
}

// ‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤
document.getElementById('q').addEventListener('input', applyFilters);

// ‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÄ‡∏≠‡∏á
document.getElementById('csvFile').addEventListener('change', async (e)=>{
  const file = e.target.files[0];
  if (!file) return;
  document.getElementById('fileName').textContent = file.name;
  RAW = await loadCSVFromFile(file);
  applyFilters();
});

// ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô: ‡∏û‡∏¢‡∏≤‡∏¢‡∏≤‡∏°‡πÇ‡∏´‡∏•‡∏î‡∏à‡∏≤‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏ó‡∏µ‡πà‡∏≠‡∏¢‡∏π‡πà‡πÇ‡∏ü‡∏•‡πÄ‡∏î‡∏≠‡∏£‡πå‡πÄ‡∏î‡∏µ‡∏¢‡∏ß‡∏Å‡∏±‡∏ô‡∏Å‡πà‡∏≠‡∏ô
(async function init(){
  try{
    RAW = await loadCSVFromUrl();
    document.getElementById('fileName').textContent = "candlestick_100_images.csv";
  }catch(err){
    console.warn("‡πÇ‡∏´‡∏•‡∏î candlestick_100_images.csv ‡πÑ‡∏°‡πà‡πÑ‡∏î‡πâ ‡πÉ‡∏´‡πâ‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡πÑ‡∏ü‡∏•‡πå‡∏î‡πâ‡∏ß‡∏¢‡∏õ‡∏∏‡πà‡∏°‡∏î‡πâ‡∏≤‡∏ô‡∏ö‡∏ô‡πÅ‡∏ó‡∏ô", err);
    RAW = [];
  }
  applyFilters();
})();
</script>

</body>
</html>
