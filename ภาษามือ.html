<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>พจนานุกรมภาษามือไทย (TSL) + AI</title>

    <!-- Tailwind -->
    <script src="https://cdn.tailwindcss.com"></script>

    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <!-- Font -->
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Thai:wght@300;400;600;700&display=swap" rel="stylesheet">

    <!-- Markdown Parser -->
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>

    <style>
        body { font-family: 'Noto Sans Thai', sans-serif; }

        /* ==== 3D Card Effects ==== */
        .card-3d {
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            box-shadow: 8px 8px 20px #d1d1d1, -8px -8px 20px #ffffff;
            transition: 0.2s;
        }
        .card-3d:active {
            transform: scale(0.96);
            box-shadow: inset 5px 5px 15px #cfcfcf, inset -5px -5px 15px #ffffff;
        }
        .btn-3d {
            background: linear-gradient(135deg, #6366f1, #8b5cf6);
            box-shadow: 4px 4px 12px rgba(99,102,241,0.4);
            transition: 0.2s;
        }
        .btn-3d:active {
            transform: scale(0.95);
            box-shadow: inset 4px 4px 10px rgba(0,0,0,0.2);
        }

        /* Glass */
        .glass {
            background: rgba(255,255,255,0.7);
            backdrop-filter: blur(10px);
        }

        /* Scrollbar Hide */
        .scrollbar-hide::-webkit-scrollbar { display: none; }
        .scrollbar-hide { -ms-overflow-style: none; scrollbar-width: none; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes zoomIn { from { transform: scale(0.9); opacity: 0; } to { transform: scale(1); opacity: 1; } }
        .animate-fade-in { animation: fadeIn 0.25s ease-out forwards; }
        .animate-zoom-in { animation: zoomIn 0.25s ease-out forwards; }

        /* Consonant Card Style */
        .consonant-card {
            aspect-ratio: 3/4;
            background: linear-gradient(145deg, #ffffff, #e6e6e6);
            border-radius: 16px;
            box-shadow: 6px 6px 16px #d1d1d1, -6px -6px 16px #ffffff;
            overflow: hidden;
            transition: 0.2s;
        }
        .consonant-card:active {
            transform: scale(0.95);
        }
    </style>
</head>

<body class="bg-slate-100 text-slate-800 pb-10">

<!-- Header -->
<header class="sticky top-0 z-40 shadow-xl bg-gradient-to-r from-blue-600 to-indigo-600 text-white">
    <div class="max-w-5xl mx-auto px-4 py-5 flex items-center gap-4">
        <div class="p-2 bg-white/20 rounded-xl shadow-inner">
            <i data-lucide="hand" class="w-8 h-8 text-yellow-300"></i>
        </div>
        <div>
            <h1 class="text-2xl font-bold drop-shadow">พจนานุกรมภาษามือไทย (TSL)</h1>
            <p class="text-blue-100 text-sm opacity-90">AI + คู่มือท่าทาง</p>
        </div>
    </div>
</header>

<main class="max-w-5xl mx-auto px-4 py-6 space-y-6">

    <!-- Search Section -->
    <div class="sticky top-[72px] z-30 bg-slate-100/80 backdrop-blur-md py-4 px-2 -mx-4 border-b border-slate-200 shadow-sm">

        <!-- Search Bar -->
        <div class="relative max-w-lg mx-auto md:mx-0">
            <div class="absolute left-3 top-0 bottom-0 flex items-center text-slate-400">
                <i data-lucide="search" class="w-5 h-5"></i>
            </div>
            <input
                id="searchInput"
                type="text"
                placeholder="ค้นหา เช่น สวัสดี , ครอบครัว , อารมณ์ …"
                class="w-full pl-10 pr-4 py-3 rounded-2xl border border-slate-200 shadow-md glass focus:ring-2 focus:ring-indigo-400 outline-none transition"
            />
        </div>

        <!-- Category & AI -->
        <div class="flex items-center gap-2 overflow-x-auto scrollbar-hide mt-3 pb-1">

            <!-- AI Button -->
            <button onclick="openAiModal()"
                class="flex-shrink-0 btn-3d px-4 py-2 rounded-full text-white font-semibold flex items-center gap-2">
                <i data-lucide="sparkles" class="w-4 h-4"></i>
                AI แปลภาษา
            </button>

            <div class="w-px h-6 bg-slate-300"></div>

            <div id="categoryContainer" class="flex gap-2"></div>
        </div>
    </div>
    <!-- Loading -->
    <div id="dataLoadingState" class="hidden py-10 text-center">
        <div class="animate-spin w-10 h-10 border-4 border-indigo-200 border-t-indigo-600 rounded-full mx-auto mb-3"></div>
        <p class="text-slate-500 text-sm">กำลังโหลดข้อมูล…</p>
    </div>

    <!-- Grid -->
    <div id="gridContainer" class="grid gap-4 min-h-[60vh]">
        <!-- JS inject -->
    </div>

    <!-- Not Found -->
    <div id="notFoundMessage" class="hidden py-12 text-center text-slate-400">
        <i data-lucide="search" class="w-12 h-12 mx-auto mb-3 opacity-20"></i>
        <p>ไม่พบคำที่ค้นหา</p>
    </div>
</main>

<!-- ===========================
      MODAL: Word Detail (3D UI)
     =========================== -->
<div id="modalOverlay"
    class="hidden fixed inset-0 z-[60] bg-black/60 backdrop-blur-md flex items-center justify-center px-4 animate-fade-in"
    onclick="handleModalClick(event)">
    
    <div class="bg-white rounded-3xl shadow-2xl max-w-lg w-full overflow-hidden animate-zoom-in max-h-[90vh] flex flex-col border border-slate-200">

        <!-- Header Image -->
        <div class="relative w-full aspect-video bg-slate-200 flex items-center justify-center">
            <img id="modalImage" src="" class="w-full h-full object-cover hidden" />
            
            <div id="modalNoImage" class="text-slate-400 text-center">
                <i data-lucide="image-off" class="w-10 h-10 mx-auto opacity-50"></i>
                <p class="text-sm">ไม่มีรูปภาพ</p>
            </div>

            <!-- Category Badge -->
            <span id="modalCategoryBadge"
                class="absolute bottom-3 left-3 px-3 py-1 rounded-full text-xs font-bold text-white shadow-lg">
            </span>

            <!-- Close -->
            <button onclick="closeModal()"
                class="absolute top-3 right-3 p-2 bg-black/40 hover:bg-black/60 text-white rounded-full backdrop-blur-sm transition">
                <i data-lucide="x"></i>
            </button>
        </div>

        <!-- Body -->
        <div class="p-6 space-y-6 overflow-y-auto">

            <!-- Title -->
            <div class="flex gap-4 items-center">
                <div id="modalIconContainer"
                    class="w-16 h-16 rounded-2xl flex items-center justify-center text-3xl font-bold text-white shadow-xl">
                </div>
                <div>
                    <h2 id="modalWord" class="text-2xl font-extrabold text-slate-800 mb-1"></h2>
                    <p class="text-sm text-slate-500">วิธีทำท่าภาษามือ</p>
                </div>
            </div>

            <!-- Description -->
            <div class="bg-slate-50 p-4 rounded-xl border border-slate-200 shadow-inner">
                <p id="modalDescription" class="text-slate-700 leading-relaxed"></p>
            </div>

            <!-- Tip -->
            <div id="modalTipContainer"
                class="hidden bg-amber-50 border border-amber-200 p-4 rounded-xl flex gap-3 items-start shadow-inner">
                
                <i data-lucide="lightbulb" class="text-amber-500 w-6 h-6"></i>
                
                <div>
                    <span class="font-bold text-amber-700 text-sm block mb-1">เทคนิคจำง่าย:</span>
                    <p id="modalTip" class="text-sm text-amber-800"></p>
                </div>
            </div>

        </div>

        <!-- Footer -->
        <div class="p-5 border-t border-slate-200 bg-white">
            <a id="modalYoutubeLink" href="#" target="_blank"
                class="w-full py-3 text-center rounded-xl font-bold flex items-center justify-center gap-2 transition active:scale-95">
                <i data-lucide="youtube"></i>
                <span id="modalYoutubeText">ดูวิดีโอ</span>
            </a>
        </div>

    </div>
</div>

<!-- ========================
     MODAL: AI TRANSLATOR (3D)
     ======================== -->
<div id="aiModalOverlay"
    class="hidden fixed inset-0 z-[60] bg-black/60 backdrop-blur-md flex items-center justify-center px-4 animate-fade-in"
    onclick="handleAiModalClick(event)">

    <div class="bg-white rounded-3xl shadow-2xl w-full max-w-lg overflow-hidden animate-zoom-in max-h-[90vh] flex flex-col border border-slate-200">

        <!-- Header -->
        <div class="p-5 bg-gradient-to-r from-indigo-600 to-purple-700 text-white flex justify-between items-center shadow-lg">
            <div class="flex items-center gap-3">
                <div class="p-2 bg-white/20 rounded-xl">
                    <i data-lucide="sparkles" class="w-6 h-6 text-yellow-300"></i>
                </div>
                <div>
                    <h2 class="text-xl font-bold">AI แปลประโยค</h2>
                    <p class="text-indigo-200 text-xs">เปลี่ยนไทย → ภาษามือ (Gloss)</p>
                </div>
            </div>

            <button onclick="closeAiModal()" class="p-2 bg-white/10 hover:bg-white/20 rounded-full transition">
                <i data-lucide="x"></i>
            </button>
        </div>

        <!-- Body -->
        <div class="p-5 space-y-4 overflow-y-auto bg-slate-50 flex-1">

            <!-- Input -->
            <div class="relative">
                <input id="aiInput" placeholder="พิมพ์ประโยค เช่น ฉันรักแม่"
                    class="w-full p-4 pr-12 rounded-xl border border-slate-300 shadow-md focus:ring-2 focus:ring-indigo-400 outline-none transition bg-white" />

                <button onclick="generateSignTranslation()"
                    class="absolute right-2 top-2 bottom-2 px-3 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg flex items-center justify-center transition">
                    <i data-lucide="arrow-right"></i>
                </button>
            </div>

            <!-- Loading -->
            <div id="aiLoading" class="hidden py-6 text-center space-y-3">
                <div class="animate-spin w-8 h-8 border-4 border-indigo-200 border-t-indigo-600 rounded-full mx-auto"></div>
                <p class="text-slate-500 text-sm">กำลังประมวลผล…</p>
            </div>

            <!-- Result -->
            <div id="aiResultArea" class="hidden space-y-4">
                
                <!-- Gloss -->
                <div class="bg-white p-4 rounded-xl border border-indigo-200 shadow">
                    <h3 class="text-xs font-bold text-indigo-600 uppercase mb-1 flex items-center gap-1">
                        <i data-lucide="git-branch" class="w-3 h-3"></i>
                        ไวยากรณ์ Gloss
                    </h3>
                    <p id="glossOutput" class="text-xl font-extrabold text-center"></p>
                </div>

                <!-- Explanation -->
                <div class="bg-white p-4 rounded-xl border border-indigo-200 shadow space-y-2">
                    <h3 class="text-xs font-bold text-indigo-600 uppercase mb-1">คำอธิบายท่าทาง</h3>
                    <div id="explanationOutput" class="text-sm text-slate-700 space-y-2"></div>
                </div>
            </div>

            <!-- Error -->
            <div id="aiError"
                class="hidden p-3 bg-red-50 border border-red-200 text-red-600 rounded-xl text-center">
                เกิดข้อผิดพลาด กรุณาลองใหม่
            </div>

        </div>
    </div>
</div>
<script>
/* =========================
    CONFIG & GLOBAL STATE
   ========================= */

const apiKey = "AIzaSyD_9mzuoLZT-tka_73IpHJWpSsBWLEM8b4";

let signData = [];
let searchTerm = "";
let activeCategory = "all";

/* หมวดหมู่ */
const categories = [
    { id: "all",          label: "ทั้งหมด",          icon: "book-open" },
    { id: "consonant",    label: "พยัญชนะ (ก-ฮ)",   icon: "type" },
    { id: "number",       label: "ตัวเลข",           icon: "hash" },
    { id: "daily",        label: "คำพื้นฐาน",       icon: "heart" },
    { id: "daily_life",   label: "ชีวิตประจำวัน",    icon: "sun" },
    { id: "family",       label: "ครอบครัว",         icon: "users" },
    { id: "emotion",      label: "อารมณ์",           icon: "smile" },
    { id: "place",        label: "สถานที่",          icon: "map-pin" },
    { id: "object",       label: "สิ่งของ",           icon: "box" },
    { id: "food",         label: "อาหาร/เครื่องดื่ม", icon: "cup-soda" },
    { id: "action",       label: "การกระทำ",        icon: "zap" },
    { id: "conversation", label: "บทสนทนา",         icon: "message-circle" },
];


/* =========================
    CATEGORY COLOR SYSTEM
   ========================= */
function getCategoryStyles(c) {
    switch (c) {
        case "consonant": return { badge: "bg-orange-500", cardColor: "bg-orange-400", text: "text-white" };
        case "number": return { badge: "bg-green-500", cardColor: "bg-green-400", text: "text-white" };
        case "daily": return { badge: "bg-purple-500", cardColor: "bg-purple-400", text: "text-white" };
        case "daily_life": return { badge: "bg-indigo-500", cardColor: "bg-indigo-400", text: "text-white" };
        case "family": return { badge: "bg-blue-500", cardColor: "bg-blue-400", text: "text-white" };
        case "emotion": return { badge: "bg-pink-500", cardColor: "bg-pink-400", text: "text-white" };
        case "place": return { badge: "bg-emerald-500", cardColor: "bg-emerald-400", text: "text-white" };
        case "object": return { badge: "bg-slate-500", cardColor: "bg-slate-400", text: "text-white" };
        case "food": return { badge: "bg-amber-500", cardColor: "bg-amber-400", text: "text-white" };
        case "action": return { badge: "bg-cyan-500", cardColor: "bg-cyan-400", text: "text-white" };
        case "conversation": return { badge: "bg-red-500", cardColor: "bg-red-400", text: "text-white" };
        default: return { badge: "bg-sky-500", cardColor: "bg-sky-400", text: "text-white" };
    }
}

/* =========================
    LOAD JSON DATA
   ========================= */
async function fetchSignData() {
    document.getElementById("dataLoadingState").classList.remove("hidden");
    document.getElementById("gridContainer").classList.add("hidden");

    try {
        const res = await fetch("signs500.json");
        signData = await res.json();
        renderGrid();
    } catch (err) {
        gridContainer.innerHTML =
            `<div class='text-center text-red-500 col-span-full'>ไม่พบไฟล์ <b>signs500.json</b></div>`;
    }

    document.getElementById("dataLoadingState").classList.add("hidden");
    document.getElementById("gridContainer").classList.remove("hidden");
}


/* =========================
       CATEGORY BUTTON UI
   ========================= */
function renderCategories() {
    const ctn = document.getElementById("categoryContainer");
    ctn.innerHTML = categories.map(c => {
        const active = (activeCategory === c.id);

        return `
        <button onclick="setActiveCategory('${c.id}')"
            class="px-4 py-2 whitespace-nowrap rounded-full border shadow 
                   ${active ? "bg-indigo-600 text-white border-indigo-600 shadow-lg" : "bg-white text-slate-600 border-slate-300 hover:bg-slate-50"} 
                   flex items-center gap-2 transition">
            <i data-lucide="${c.icon}" class="w-4 h-4"></i>
            ${c.label}
        </button>`;
    }).join("");

    lucide.createIcons();
}

function setActiveCategory(id) {
    activeCategory = id;
    renderCategories();
    renderGrid();
}


/* =========================
        RENDER GRID
   ========================= */
function renderGrid() {
    const grid = document.getElementById("gridContainer");
    const term = searchTerm.toLowerCase();

    const filtered = signData.filter(item => {
        const w = (item.word || "").toLowerCase();
        const d = (item.description || "").toLowerCase();

        const matchSearch = w.includes(term) || d.includes(term);
        const matchCategory = activeCategory === "all" || item.category === activeCategory;

        return matchSearch && matchCategory;
    });

    /* Layout */
    grid.className =
        activeCategory === "consonant"
            ? "grid grid-cols-3 sm:grid-cols-4 md:grid-cols-5 lg:grid-cols-6 gap-3"
            : "grid grid-cols-2 sm:grid-cols-2 md:grid-cols-3 gap-4";

    if (!filtered.length) {
        notFoundMessage.classList.remove("hidden");
        grid.innerHTML = "";
        return;
    }

    notFoundMessage.classList.add("hidden");

    grid.innerHTML = filtered.map(item => {
        const styles = getCategoryStyles(item.category);
        const short = (item.word || "").split(" ")[0];

        /* ==============
            Consonant Card
           ============== */
        if (item.category === "consonant") {
            return `
            <div onclick="openModal('${item.id}')"
                class="consonant-card cursor-pointer group">
                
                <div class="w-full h-[75%] overflow-hidden bg-slate-200">
                    <img src="${item.imageUrl || ""}" 
                         class="w-full h-full object-cover group-hover:scale-110 transition">
                </div>

                <div class="h-[25%] flex items-center justify-center text-2xl font-bold text-slate-800">
                    ${short}
                </div>
            </div>`;
        }

        /* ==============
            Standard Card (3D Small)
           ============== */
        return `
        <div onclick="openModal('${item.id}')"
            class="card-3d cursor-pointer flex items-center gap-3 p-3 rounded-xl border border-slate-200 hover:shadow-xl transition">

            <div class="w-12 h-12 rounded-xl flex items-center justify-center text-xl font-bold ${styles.cardColor} ${styles.text} shadow">
                ${short}
            </div>

            <div class="flex-1 min-w-0">
                <h3 class="font-bold text-slate-800 truncate">${item.word}</h3>
                <p class="text-[11px] text-slate-500 truncate">${item.description || ""}</p>
            </div>
        </div>`;
    }).join("");
}


/* =========================
         OPEN MODAL
   ========================= */
function openModal(id) {
    const item = signData.find(i => i.id == id);
    if (!item) return;

    document.body.style.overflow = "hidden";
    modalOverlay.classList.remove("hidden");

    const img = document.getElementById("modalImage");
    const noImg = document.getElementById("modalNoImage");

    if (item.imageUrl) {
        img.src = item.imageUrl;
        img.classList.remove("hidden");
        noImg.classList.add("hidden");
    } else {
        img.classList.add("hidden");
        noImg.classList.remove("hidden");
    }

    const styles = getCategoryStyles(item.category);

    modalCategoryBadge.textContent = styles.badgeLabel;
    modalCategoryBadge.className = `px-3 py-1 rounded-full text-xs font-bold text-white shadow-lg ${styles.badge}`;

    modalIconContainer.textContent = (item.word || "").charAt(0);
    modalIconContainer.className = `w-16 h-16 rounded-2xl flex items-center justify-center text-3xl font-bold shadow-lg ${styles.cardColor} ${styles.text}`;

    modalWord.textContent = item.word;
    modalDescription.textContent = item.description || "";

    if (item.tip) {
        modalTipContainer.classList.remove("hidden");
        modalTip.textContent = item.tip;
    } else {
        modalTipContainer.classList.add("hidden");
    }

    /* Youtube Button */
    if (item.youtubeUrl) {
        modalYoutubeLink.href = item.youtubeUrl;
        modalYoutubeLink.className = "bg-red-600 hover:bg-red-700 text-white rounded-xl py-3 flex items-center justify-center gap-2 shadow-md";
        modalYoutubeText.textContent = "ดูวิดีโอสาธิต";
    } else {
        const q = encodeURIComponent("ภาษามือไทย " + item.word);
        modalYoutubeLink.href = `https://www.youtube.com/results?search_query=${q}`;
        modalYoutubeLink.className = "bg-slate-100 hover:bg-slate-200 rounded-xl py-3 text-slate-700 flex items-center justify-center gap-2";
        modalYoutubeText.textContent = "ค้นหาใน YouTube";
    }

    lucide.createIcons();
}

function closeModal() {
    modalOverlay.classList.add("hidden");
    document.body.style.overflow = "";
}

function handleModalClick(e) {
    if (e.target.id === "modalOverlay") closeModal();
}


/* =========================
       AI TRANSLATION
   ========================= */
function openAiModal() {
    aiModalOverlay.classList.remove("hidden");
    document.body.style.overflow = "hidden";
    aiInput.focus();
}

function closeAiModal() {
    aiModalOverlay.classList.add("hidden");
    document.body.style.overflow = "";
}

function handleAiModalClick(e) {
    if (e.target.id === "aiModalOverlay") closeAiModal();
}

function handleAiEnter(e) {
    if (e.key === "Enter") generateSignTranslation();
}

async function generateSignTranslation() {
    const text = aiInput.value.trim();
    if (!text) return;

    aiLoading.classList.remove("hidden");
    aiResultArea.classList.add("hidden");
    aiError.classList.add("hidden");

    try {
        const prompt = `
            Convert Thai sentence to Thai Sign Language Gloss (TSL).
            Then list gesture explanations.
            Output JSON:
            {
                "gloss":"",
                "explanations":[{"word":"","desc":""}]
            }
            Input: "${text}"
        `;

        const res = await fetch(
          `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`,
          {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify({
                  contents: [{ parts: [{ text: prompt }] }],
                  generationConfig: { responseMimeType: "application/json" }
              })
          }
        );

        const data = await res.json();
        const json = JSON.parse(data.candidates[0].content.parts[0].text);

        glossOutput.textContent = json.gloss || "";
        explanationOutput.innerHTML = (json.explanations || [])
            .map(ex => `
                <div class="bg-white border border-slate-200 p-3 rounded-xl shadow-sm flex gap-3">
                    <div class="font-bold text-indigo-600 min-w-[60px]">${ex.word}</div>
                    <div>${ex.desc}</div>
                </div>
            `).join("");

        aiLoading.classList.add("hidden");
        aiResultArea.classList.remove("hidden");

    } catch (err) {
        aiLoading.classList.add("hidden");
        aiError.classList.remove("hidden");
        console.error(err);
    }
}


/* =========================
         SEARCH LISTENER
   ========================= */
document.getElementById("searchInput").addEventListener("input", e => {
    searchTerm = e.target.value;
    renderGrid();
});


/* =========================
           INIT
   ========================= */
renderCategories();
fetchSignData();
lucide.createIcons();
</script>
</body>
</html>
