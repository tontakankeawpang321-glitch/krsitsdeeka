<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>เช็คราคาขยะรีไซเคิล (EcoPrice AI)</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: { sans: ['Prompt', 'sans-serif'] },
                    colors: {
                        primary: '#10B981', secondary: '#065F46', accent: '#F59E0B',
                        paper: '#F3F4F6', metal: '#9CA3AF', plastic: '#60A5FA', glass: '#A78BFA'
                    }
                }
            }
        }
    </script>

    <style>
        body { background-color: #f0fdf4; font-family: 'Prompt', sans-serif; }
        .price-item { transition: all 0.3s ease; }
        .price-flash { animation: flashHighlight 1s ease-out; }
        @keyframes flashHighlight {
            0% { background-color: #d1fae5; transform: scale(1.02); }
            100% { background-color: white; transform: scale(1); }
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* Chatbot Custom Styles */
        .chat-bubble::before { content: ''; position: absolute; width: 0; height: 0; border-style: solid; }
        .chat-bubble-user::before { border-width: 0 12px 12px 12px; border-color: transparent transparent #10B981 transparent; top: -10px; right: 12px; }
        .chat-bubble-model::before { border-width: 0 12px 12px 12px; border-color: transparent transparent #e5e7eb transparent; top: -10px; left: 12px; }
        
        .gemini-thinking-bar { position: relative; width: 100%; height: 4px; background-color: #e0e0e0; border-radius: 2px; overflow: hidden; }
        .gemini-thinking-bar::before { content: ''; position: absolute; top: 0; left: 0; height: 100%; width: 100%; background: linear-gradient(90deg, #10B981, #34D399, #10B981); background-size: 200% 100%; animation: thinking-gradient 2s linear infinite; }
        @keyframes thinking-gradient { 0% { background-position: 200% 0; } 100% { background-position: -200% 0; } }

        #fab-chat-toggle { position: fixed; bottom: 100px; right: 20px; width: 60px; height: 60px; background-color: #10B981; color: white; border-radius: 50%; font-size: 28px; display: flex; align-items: center; justify-content: center; box-shadow: 0 4px 12px rgba(0,0,0,0.3); cursor: pointer; z-index: 45; transition: all 0.3s; }
        #chatbot-modal.chatbot-hidden { opacity: 0; transform: translateY(100%); pointer-events: none; }
        #chatbot-modal { position: fixed; inset: 0; z-index: 1000; transition: all 0.3s; }

        /* FB Container Styling */
        .fb-container {
            width: 100%;
            background: white;
            border-radius: 1rem;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border: 1px solid #e5e7eb;
        }
        .fb-display-wrapper {
            width: 100%;
            min-height: 400px; /* ความสูงขั้นต่ำสำหรับโหลด SDK */
            display: flex;
            justify-content: center;
            background: #f9fafb;
        }
    </style>
</head>
<body class="text-gray-800 pb-24">
    <!-- โหลด SDK ของ Facebook -->
    <div id="fb-root"></div>
    <script async defer crossorigin="anonymous" 
        src="https://connect.facebook.net/th_TH/sdk.js#xfbml=1&version=v19.0" nonce="abc123">
    </script>

    <!-- Header -->
    <header class="bg-gradient-to-r from-primary to-secondary text-white p-6 shadow-lg rounded-b-3xl relative overflow-hidden">
        <div class="relative z-10 flex justify-between items-start">
            <div>
                <h1 class="text-2xl font-bold mb-1"><i class="fa-solid fa-recycle mr-2"></i>EcoPrice AI</h1>
                <p class="text-emerald-100 text-sm" id="currentDate">กำลังโหลดวันที่...</p>
            </div>
            <button onclick="updatePricesWithAI()" class="bg-white bg-opacity-20 hover:bg-opacity-30 backdrop-blur-sm text-white text-xs px-3 py-2 rounded-lg border border-white/30 flex items-center">
                <i class="fa-solid fa-sync mr-2"></i> อัปเดตราคา
            </button>
        </div>
    </header>

    <!-- Content Area -->
    <div class="mt-4 px-4 space-y-4">
        
        <!-- จอแสดงผล Facebook Group Plugin -->
        <div class="fb-container">
            <div class="bg-[#1877F2] text-white px-4 py-3 flex items-center justify-between">
                <div class="flex items-center text-xs font-bold">
                    <i class="fa-brands fa-facebook mr-2 text-base"></i> ชุมชนราคากลางขยะ
                </div>
                <div class="text-[10px] bg-white/20 px-2 py-1 rounded">Timeline อัปเดต</div>
            </div>
            <div class="fb-display-wrapper">
                <!-- ตัวอย่างแสดงเพจ / กลุ่ม -->
                <div class="fb-page" 
                    data-href="https://www.facebook.com/p/%E0%B8%A7%E0%B8%87%E0%B8%A9%E0%B9%8C%E0%B8%9E%E0%B8%B2%E0%B8%93%E0%B8%B4%E0%B8%8A%E0%B8%A2%E0%B9%8C%E0%B8%A3%E0%B8%B1%E0%B8%9A%E0%B8%8B%E0%B8%B7%E0%B9%89%E0%B8%AD%E0%B8%82%E0%B8%AD%E0%B8%87%E0%B9%80%E0%B8%81%E0%B9%88%E0%B8%B2-100064175737067/" 
                    data-tabs="timeline" 
                    data-width="500" 
                    data-height="500" 
                    data-small-header="false" 
                    data-adapt-container-width="true" 
                    data-hide-cover="false" 
                    data-show-facepile="true">
                    <blockquote cite="https://www.facebook.com/p/%E0%B8%A7%E0%B8%87%E0%B8%A9%E0%B9%8C%E0%B8%9E%E0%B8%B2%E0%B8%93%E0%B8%B4%E0%B8%8A%E0%B8%A2%E0%B9%8C%E0%B8%A3%E0%B8%B1%E0%B8%9A%E0%B8%8B%E0%B8%B7%E0%B9%89%E0%B8%AD%E0%B8%82%E0%B8%AD%E0%B8%87%E0%B9%80%E0%B8%81%E0%B9%88%E0%B8%B2-100064175737067/" class="fb-xfbml-parse-ignore">
                        <a href="https://www.facebook.com/p/%E0%B8%A7%E0%B8%87%E0%B8%A9%E0%B9%8C%E0%B8%9E%E0%B8%B2%E0%B8%93%E0%B8%B4%E0%B8%8A%E0%B8%A2%E0%B9%8C%E0%B8%A3%E0%B8%B1%E0%B8%9A%E0%B8%8B%E0%B8%B7%E0%B9%89%E0%B8%AD%E0%B8%82%E0%B8%AD%E0%B8%87%E0%B9%80%E0%B8%81%E0%B9%88%E0%B8%B2-100064175737067/">กำลังโหลดข้อมูลชุมชน...</a>
                    </blockquote>
                </div>
            </div>
        </div>

        <!-- Search Bar -->
        <div class="relative group">
            <i class="fa-solid fa-magnifying-glass absolute left-4 top-1/2 -translate-y-1/2 text-gray-400 group-focus-within:text-primary transition-colors"></i>
            <input type="text" id="searchInput" oninput="handleSearch()" placeholder="ค้นหาชื่อขยะ เช่น ขวดพลาสติก, ลัง..." class="w-full pl-11 pr-4 py-3 bg-white rounded-2xl shadow-sm border border-gray-100 focus:outline-none focus:ring-2 focus:ring-primary/50 transition-all text-gray-700">
        </div>

        <!-- Category Horizontal Scroll -->
        <div class="flex overflow-x-auto space-x-3 hide-scrollbar pb-2" id="categoryContainer">
            <button onclick="filterCategory('all')" class="cat-btn bg-gray-800 text-white px-5 py-2 rounded-full whitespace-nowrap shadow-sm border-2 border-transparent">ทั้งหมด</button>
            <button onclick="filterCategory('paper')" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100"><i class="fa-solid fa-newspaper mr-1 text-gray-500"></i> กระดาษ</button>
            <button onclick="filterCategory('plastic')" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100"><i class="fa-solid fa-bottle-water mr-1 text-blue-400"></i> พลาสติก</button>
            <button onclick="filterCategory('metal')" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100"><i class="fa-solid fa-gavel mr-1 text-orange-400"></i> โลหะ</button>
            <button onclick="filterCategory('glass')" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100"><i class="fa-solid fa-wine-bottle mr-1 text-purple-400"></i> แก้ว</button>
            <button onclick="filterCategory('electronic')" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100"><i class="fa-solid fa-plug mr-1 text-yellow-500"></i> อิเล็กทรอนิกส์</button>
            <button onclick="filterCategory('other')" class="cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100"><i class="fa-solid fa-ellipsis mr-1 text-gray-400"></i> อื่นๆ</button>
        </div>
    </div>

    <!-- Price List Section -->
    <div class="mt-4 px-4">
        <div class="flex justify-between items-center mb-3">
            <h2 class="font-bold text-lg text-gray-700">รายการราคาล่าสุด</h2>
            <div id="statusIndicator" class="flex items-center text-[10px] text-gray-400 bg-white px-2 py-1 rounded-full shadow-sm border border-gray-50">
                <div id="statusDot" class="w-1.5 h-1.5 rounded-full bg-green-500 mr-1.5 animate-pulse"></div>
                <span id="updateTimeText">อัปเดตเรียลไทม์</span>
            </div>
        </div>
        <div id="priceList" class="space-y-3 pb-20">
            <!-- Items injected by JS -->
        </div>
        <div id="noResults" class="hidden py-10 text-center text-gray-400">
            <i class="fa-solid fa-box-open text-4xl mb-2"></i>
            <p>ไม่พบรายการที่ค้นหา</p>
        </div>
    </div>

    <!-- Loading Overlay -->
    <div id="aiLoadingOverlay" class="fixed inset-0 bg-black/60 z-[100] hidden flex flex-col items-center justify-center backdrop-blur-md">
        <div class="relative w-24 h-24 mb-4 flex items-center justify-center">
            <div class="absolute inset-0 border-4 border-emerald-500/20 rounded-full"></div>
            <div class="absolute inset-0 border-4 border-emerald-500 rounded-full border-t-transparent animate-spin"></div>
            <i class="fa-solid fa-robot text-4xl text-white"></i>
        </div>
        <h3 class="text-white text-xl font-bold mb-2">Eco AI กำลังดึงข้อมูล...</h3>
        <p class="text-emerald-200 text-sm animate-pulse" id="aiLoadingText">สแกนแหล่งรับซื้อทั่วประเทศ</p>
    </div>

    <!-- Calculator Modal -->
    <div id="calculatorModal" class="fixed inset-0 bg-black/50 z-[60] hidden flex items-end sm:items-center justify-center">
        <div class="bg-white w-full sm:w-96 rounded-t-3xl sm:rounded-2xl p-6 shadow-2xl">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-bold text-gray-800">คำนวณราคา</h3>
                <button onclick="closeCalculator()" class="text-gray-400 p-2"><i class="fa-solid fa-times text-xl"></i></button>
            </div>
            <div class="bg-emerald-50 p-4 rounded-2xl mb-4 flex items-center">
                <div id="calcIcon" class="w-12 h-12 rounded-full bg-white flex items-center justify-center text-xl shadow-sm mr-3"></div>
                <div>
                    <h4 id="calcItemName" class="font-bold text-gray-800">ชื่อขยะ</h4>
                    <p class="text-sm text-gray-500">ราคา <span id="calcItemPrice" class="font-bold text-primary">0</span> บาท/กก.</p>
                </div>
            </div>
            <div class="mb-6">
                <label class="block text-sm font-medium text-gray-600 mb-2">ใส่น้ำหนัก (กก.)</label>
                <div class="flex items-center border-2 border-gray-100 rounded-2xl overflow-hidden focus-within:border-primary transition-all">
                    <input type="number" id="weightInput" class="w-full p-4 outline-none text-2xl font-bold" placeholder="0.00" oninput="calculateTotal()">
                    <span class="bg-gray-50 px-6 py-4 text-gray-500 font-bold border-l">กก.</span>
                </div>
            </div>
            <div class="flex justify-between items-center border-t border-dashed pt-4 mb-6">
                <span class="text-gray-500 font-medium">รวมเป็นเงิน</span>
                <span class="text-3xl font-black text-primary" id="totalValue">0.00 ฿</span>
            </div>
            <button onclick="addToBasket()" class="w-full bg-primary hover:bg-secondary text-white font-bold py-4 rounded-2xl shadow-lg transition-transform active:scale-95">
                <i class="fa-solid fa-cart-plus mr-2"></i> เพิ่มลงรายการ
            </button>
        </div>
    </div>

    <!-- Bottom Basket Summary -->
    <div id="basketSummary" class="fixed bottom-0 left-0 w-full bg-white shadow-[0_-8px_30px_rgb(0,0,0,0.12)] p-4 rounded-t-3xl transform translate-y-full transition-transform duration-500 z-50">
        <div class="max-w-3xl mx-auto flex justify-between items-center">
            <div class="flex items-center">
                <div class="bg-primary/10 p-3 rounded-xl mr-3">
                    <i class="fa-solid fa-basket-shopping text-primary text-xl"></i>
                </div>
                <div>
                    <p class="text-[10px] uppercase tracking-wider text-gray-400 font-bold">ยอดรวมประเมิน (<span id="basketCount">0</span> รายการ)</p>
                    <h3 class="text-2xl font-black text-primary" id="basketTotal">0.00 ฿</h3>
                </div>
            </div>
            <div class="flex space-x-2">
                <button onclick="resetBasket()" class="text-gray-400 px-4 py-2 font-bold text-sm">ล้าง</button>
                <button class="bg-primary hover:bg-secondary text-white px-6 py-3 rounded-xl font-bold text-sm shadow-md">บันทึก</button>
            </div>
        </div>
    </div>

    <!-- FAB AI Toggle -->
    <button id="fab-chat-toggle">
        <i class="fa-solid fa-robot"></i>
    </button>

    <!-- Chatbot Modal -->
    <div id="chatbot-modal" class="chatbot-hidden">
        <div class="flex flex-col h-screen bg-gray-100">
            <header class="bg-primary text-white p-4 flex justify-between items-center shadow-md">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-white/20 rounded-full flex items-center justify-center"><i class="fa-solid fa-robot"></i></div>
                    <div>
                        <h1 class="text-sm font-bold m-0">Eco AI Assistant</h1>
                        <p class="text-[10px] text-emerald-100 opacity-80">ผู้ช่วยส่วนตัวเรื่องขยะ</p>
                    </div>
                </div>
                <button id="chatbot-close-btn" class="bg-black/20 hover:bg-black/30 w-8 h-8 rounded-full"><i class="fa-solid fa-times"></i></button>
            </header>

            <main id="chat-history" class="flex-1 overflow-y-auto p-4 space-y-4">
                <div class="flex items-start space-x-2">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-xs"><i class="fa-solid fa-robot"></i></div>
                    <div class="chat-bubble chat-bubble-model bg-white text-gray-800 p-3 rounded-2xl max-w-[80%] relative shadow-sm border border-gray-100">
                        <p class="text-sm">สวัสดีครับ! สอบถามราคาขยะ หรือวิธีคัดแยกได้เลยนะครับ</p>
                    </div>
                </div>
            </main>

            <div id="thinking-indicator" class="p-4 hidden">
                <div class="flex items-center space-x-2">
                    <div class="w-8 h-8 bg-primary rounded-full flex items-center justify-center text-white text-xs"><i class="fa-solid fa-robot"></i></div>
                    <div class="chat-bubble chat-bubble-model bg-white p-4 rounded-2xl w-32 shadow-sm border border-gray-100">
                        <div class="gemini-thinking-bar"></div>
                    </div>
                </div>
            </div>

            <footer class="bg-white p-4 border-t border-gray-100">
                <div class="flex space-x-2">
                    <input id="user-input" type="text" placeholder="พิมพ์ข้อความ..." class="flex-1 p-3 bg-gray-50 border border-gray-100 rounded-xl focus:outline-none focus:ring-2 focus:ring-primary">
                    <button id="send-btn" class="bg-primary text-white w-12 h-12 rounded-xl flex items-center justify-center shadow-lg"><i class="fa-solid fa-paper-plane"></i></button>
                </div>
            </footer>
        </div>
    </div>

    <script>
        // --- Data Mockup ---
        let wasteData = [
              { id: 1, name: 'กระดาษขาวดำ', category: 'paper', price: 4, trend: 'stable', icon: 'fa-file-alt', color: 'text-gray-500' },
  { id: 2, name: 'กระดาษลูกฟูก (ลัง)', category: 'paper', price: 3, trend: 'stable', icon: 'fa-box-open', color: 'text-yellow-700' },
  { id: 3, name: 'กระดาษหนังสือพิมพ์', category: 'paper', price: 2.5, trend: 'stable', icon: 'fa-newspaper', color: 'text-gray-600' },
  { id: 4, name: 'กระดาษเล่ม/สมุด', category: 'paper', price: 2, trend: 'stable', icon: 'fa-book', color: 'text-blue-800' },

  { id: 5, name: 'ขวด PET (ใส)', category: 'plastic', price: 14, trend: 'stable', icon: 'fa-bottle-water', color: 'text-blue-400' },
  { id: 6, name: 'ขวด PET (สี)', category: 'plastic', price: 8, trend: 'stable', icon: 'fa-bottle-water', color: 'text-green-500' },
  { id: 7, name: 'พลาสติก HDPE', category: 'plastic', price: 18, trend: 'stable', icon: 'fa-jug-detergent', color: 'text-gray-300' },
  { id: 8, name: 'พลาสติก PP', category: 'plastic', price: 10, trend: 'stable', icon: 'fa-chair', color: 'text-red-400' },
  { id: 9, name: 'ท่อ PVC (ฟ้า)', category: 'plastic', price: 6, trend: 'stable', icon: 'fa-circle-notch', color: 'text-blue-600' },

  { id: 10, name: 'ทองแดง (สายไฟปอก)', category: 'metal', price: 280, trend: 'up', icon: 'fa-bolt', color: 'text-orange-600' },
  { id: 11, name: 'ทองแดง (เผา)', category: 'metal', price: 240, trend: 'stable', icon: 'fa-fire', color: 'text-red-700' },
  { id: 12, name: 'อลูมิเนียม (กระป๋อง)', category: 'metal', price: 70, trend: 'stable', icon: 'fa-can-food', color: 'text-gray-400' },
  { id: 13, name: 'อลูมิเนียม (หนา)', category: 'metal', price: 85, trend: 'stable', icon: 'fa-layer-group', color: 'text-gray-500' },
  { id: 14, name: 'เหล็กหนา', category: 'metal', price: 9, trend: 'stable', icon: 'fa-weight-hanging', color: 'text-gray-700' },
  { id: 15, name: 'เหล็กบาง/สังกะสี', category: 'metal', price: 7, trend: 'stable', icon: 'fa-sheet-plastic', color: 'text-gray-400' },
  { id: 16, name: 'สแตนเลส 304', category: 'metal', price: 45, trend: 'stable', icon: 'fa-utensils', color: 'text-gray-400' },

  { id: 17, name: 'ขวดแก้ว (รวม)', category: 'glass', price: 1, trend: 'stable', icon: 'fa-wine-bottle', color: 'text-amber-800' },
  { id: 18, name: 'ขวดแก้ว (ใส)', category: 'glass', price: 2, trend: 'stable', icon: 'fa-wine-glass', color: 'text-blue-200' },
  { id: 19, name: 'ขวดแก้ว (เขียว)', category: 'glass', price: 1.5, trend: 'stable', icon: 'fa-wine-glass', color: 'text-green-700' },
  { id: 20, name: 'ขวดแก้ว (น้ำตาล)', category: 'glass', price: 1.2, trend: 'stable', icon: 'fa-wine-glass', color: 'text-amber-700' },

  { id: 21, name: 'เศษกระจกแตก', category: 'glass', price: 0.5, trend: 'down', icon: 'fa-triangle-exclamation', color: 'text-red-600' },

  { id: 22, name: 'สายไฟรวม', category: 'electronic', price: 35, trend: 'stable', icon: 'fa-plug', color: 'text-yellow-500' },
  { id: 23, name: 'แผงวงจร PCB', category: 'electronic', price: 120, trend: 'up', icon: 'fa-microchip', color: 'text-green-600' },
  { id: 24, name: 'อะแดปเตอร์ไฟ', category: 'electronic', price: 15, trend: 'stable', icon: 'fa-charging-station', color: 'text-gray-500' },
  { id: 25, name: 'แบตเตอรี่แห้ง', category: 'electronic', price: 10, trend: 'stable', icon: 'fa-battery-half', color: 'text-red-500' },
  { id: 26, name: 'แบตเตอรี่ลิเธียม', category: 'electronic', price: 60, trend: 'up', icon: 'fa-battery-full', color: 'text-green-500' },

  { id: 27, name: 'โทรศัพท์มือถือเก่า', category: 'electronic', price: 40, trend: 'up', icon: 'fa-mobile-screen', color: 'text-blue-500' },
  { id: 28, name: 'คอมพิวเตอร์เก่า', category: 'electronic', price: 18, trend: 'stable', icon: 'fa-desktop', color: 'text-gray-600' },
  { id: 29, name: 'จอ LCD', category: 'electronic', price: 25, trend: 'stable', icon: 'fa-tv', color: 'text-black' },
  { id: 30, name: 'สายชาร์จ', category: 'electronic', price: 12, trend: 'stable', icon: 'fa-cable-car', color: 'text-gray-400' },

  { id: 31, name: 'ถุงพลาสติกใส', category: 'plastic', price: 2, trend: 'down', icon: 'fa-bag-shopping', color: 'text-gray-300' },
  { id: 32, name: 'ฟิล์มยืด', category: 'plastic', price: 5, trend: 'stable', icon: 'fa-scroll', color: 'text-blue-300' },
  { id: 33, name: 'กล่องโฟม', category: 'plastic', price: 1, trend: 'down', icon: 'fa-cube', color: 'text-gray-200' },
  { id: 34, name: 'พลาสติกแข็งผสม', category: 'plastic', price: 6, trend: 'stable', icon: 'fa-puzzle-piece', color: 'text-purple-400' },
  { id: 35, name: 'ฝาขวดพลาสติก', category: 'plastic', price: 7, trend: 'stable', icon: 'fa-circle', color: 'text-red-500' },

  { id: 36, name: 'ทองเหลือง', category: 'metal', price: 160, trend: 'up', icon: 'fa-ring', color: 'text-yellow-600' },
  { id: 37, name: 'ตะกั่ว', category: 'metal', price: 55, trend: 'stable', icon: 'fa-weight-scale', color: 'text-gray-800' },
  { id: 38, name: 'สายทองแดงไม่ปอก', category: 'metal', price: 180, trend: 'stable', icon: 'fa-wave-square', color: 'text-orange-500' },
  { id: 39, name: 'เศษเหล็กรถยนต์', category: 'metal', price: 10, trend: 'up', icon: 'fa-car', color: 'text-gray-700' },
  { id: 40, name: 'ลวดเหล็ก', category: 'metal', price: 8, trend: 'stable', icon: 'fa-grip-lines', color: 'text-gray-500' },

  { id: 41, name: 'ยางรถยนต์', category: 'other', price: 3, trend: 'stable', icon: 'fa-circle-dot', color: 'text-black' },
  { id: 42, name: 'เศษผ้า', category: 'other', price: 4, trend: 'stable', icon: 'fa-shirt', color: 'text-indigo-400' },
  { id: 43, name: 'ไม้พาเลท', category: 'other', price: 2, trend: 'stable', icon: 'fa-tree', color: 'text-green-700' },
  { id: 44, name: 'เศษไม้', category: 'other', price: 1.5, trend: 'stable', icon: 'fa-tree-city', color: 'text-brown-600' },

  { id: 45, name: 'หลอด LED', category: 'electronic', price: 30, trend: 'up', icon: 'fa-lightbulb', color: 'text-green-400' },
  { id: 46, name: 'หลอดไฟเก่า', category: 'electronic', price: 5, trend: 'stable', icon: 'fa-lightbulb', color: 'text-yellow-400' },

  { id: 47, name: 'เครื่องใช้ไฟฟ้าเก่า', category: 'electronic', price: 15, trend: 'stable', icon: 'fa-blender', color: 'text-gray-500' },
  { id: 48, name: 'ตู้เย็นเก่า', category: 'electronic', price: 12, trend: 'stable', icon: 'fa-snowflake', color: 'text-cyan-400' },
  { id: 49, name: 'เครื่องซักผ้าเก่า', category: 'electronic', price: 14, trend: 'stable', icon: 'fa-water', color: 'text-blue-500' },
  { id: 50, name: 'ไมโครเวฟเก่า', category: 'electronic', price: 10, trend: 'stable', icon: 'fa-box', color: 'text-gray-500' }
        ];

        let currentCategory = 'all';
        let searchQuery = '';
        let basket = [];
        let selectedItem = null;

        document.addEventListener('DOMContentLoaded', () => {
            renderDate();
            filterItems();
        });

        function renderDate() {
            const date = new Date();
            document.getElementById('currentDate').innerText = date.toLocaleDateString('th-TH', { weekday: 'long', day: 'numeric', month: 'long', year: 'numeric' });
        }

        function handleSearch() {
            searchQuery = document.getElementById('searchInput').value.trim().toLowerCase();
            filterItems();
        }

        function filterCategory(category) {
            currentCategory = category;
            const buttons = document.querySelectorAll('.cat-btn');
            buttons.forEach(btn => {
                const clickAttr = btn.getAttribute('onclick');
                if (clickAttr.includes(`'${category}'`)) {
                    btn.className = "cat-btn bg-gray-800 text-white px-5 py-2 rounded-full whitespace-nowrap shadow-sm border-2 border-transparent";
                } else {
                    btn.className = "cat-btn bg-white text-gray-600 px-5 py-2 rounded-full whitespace-nowrap shadow-sm border border-gray-100";
                }
            });
            filterItems();
        }

        function filterItems(animate = false) {
            const filtered = wasteData.filter(item => {
                const matchCategory = currentCategory === 'all' || item.category === currentCategory;
                const matchSearch = item.name.toLowerCase().includes(searchQuery);
                return matchCategory && matchSearch;
            });
            renderItems(filtered, animate);
            const noRes = document.getElementById('noResults');
            if (filtered.length === 0) noRes.classList.remove('hidden');
            else noRes.classList.add('hidden');
        }

        function renderItems(items, animate = false) {
            const container = document.getElementById('priceList');
            container.innerHTML = '';
            items.forEach((item, index) => {
                const trendIcon = item.trend === 'up' ? '<i class="fa-solid fa-arrow-trend-up text-green-500"></i>' : 
                                  item.trend === 'down' ? '<i class="fa-solid fa-arrow-trend-down text-red-400"></i>' : 
                                  '<i class="fa-solid fa-minus text-gray-300"></i>';
                const card = document.createElement('div');
                card.className = `price-item bg-white p-4 rounded-2xl shadow-sm border border-gray-50 flex justify-between items-center cursor-pointer hover:shadow-md transition-all ${animate ? 'price-flash' : ''}`;
                if (animate) card.style.animationDelay = `${index * 50}ms`;
                card.onclick = () => openCalculator(item);
                card.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-12 h-12 rounded-xl bg-gray-50 flex items-center justify-center mr-4 text-xl ${item.color}"><i class="fa-solid ${item.icon}"></i></div>
                        <div><h3 class="font-bold text-gray-800">${item.name}</h3><div class="flex items-center text-[10px] text-gray-400 font-bold uppercase">ตลาดกลาง ${trendIcon}</div></div>
                    </div>
                    <div class="text-right"><div class="text-xl font-black text-primary">${item.price.toFixed(2)}</div><div class="text-[10px] text-gray-400 font-bold">บาท/กก.</div></div>
                `;
                container.appendChild(card);
            });
        }

        async function updatePricesWithAI() {
            const overlay = document.getElementById('aiLoadingOverlay');
            overlay.classList.remove('hidden');
            await new Promise(r => setTimeout(r, 1200));
            wasteData = wasteData.map(item => ({ ...item, price: item.price + (Math.random() * 2 - 1), trend: Math.random() > 0.5 ? 'up' : 'down' }));
            filterItems(true);
            overlay.classList.add('hidden');
        }

        function openCalculator(item) {
            selectedItem = item;
            document.getElementById('calcItemName').innerText = item.name;
            document.getElementById('calcItemPrice').innerText = item.price.toFixed(2);
            document.getElementById('calcIcon').innerHTML = `<i class="fa-solid ${item.icon} ${item.color}"></i>`;
            document.getElementById('weightInput').value = '';
            document.getElementById('totalValue').innerText = '0.00 ฿';
            document.getElementById('calculatorModal').classList.remove('hidden');
            document.getElementById('weightInput').focus();
        }

        function closeCalculator() { document.getElementById('calculatorModal').classList.add('hidden'); selectedItem = null; }

        function calculateTotal() {
            const weight = parseFloat(document.getElementById('weightInput').value) || 0;
            document.getElementById('totalValue').innerText = (weight * selectedItem.price).toLocaleString('th-TH', { minimumFractionDigits: 2 }) + ' ฿';
        }

        function addToBasket() {
            const weight = parseFloat(document.getElementById('weightInput').value) || 0;
            if (weight > 0) basket.push({ ...selectedItem, weight, total: weight * selectedItem.price });
            updateBasketUI();
            closeCalculator();
        }

        function updateBasketUI() {
            const bar = document.getElementById('basketSummary');
            if (basket.length > 0) bar.classList.remove('translate-y-full');
            else bar.classList.add('translate-y-full');
            const total = basket.reduce((sum, item) => sum + item.total, 0);
            document.getElementById('basketCount').innerText = basket.length;
            document.getElementById('basketTotal').innerText = total.toLocaleString('th-TH', { minimumFractionDigits: 2 }) + ' ฿';
        }

        function resetBasket() { basket = []; updateBasketUI(); }

        // Chatbot Logic
        const chatToggle = document.getElementById('fab-chat-toggle');
        const chatModal = document.getElementById('chatbot-modal');
        const chatClose = document.getElementById('chatbot-close-btn');
        const userInput = document.getElementById('user-input');
        const sendBtn = document.getElementById('send-btn');
        const chatHistory = document.getElementById('chat-history');

        chatToggle.onclick = () => { chatModal.classList.remove('chatbot-hidden'); chatToggle.style.opacity = '0'; };
        chatClose.onclick = () => { chatModal.classList.add('chatbot-hidden'); chatToggle.style.opacity = '1'; };

        sendBtn.onclick = () => {
            const msg = userInput.value.trim();
            if (!msg) return;
            const uDiv = document.createElement('div');
            uDiv.className = "flex justify-end";
            uDiv.innerHTML = `<div class="bg-primary text-white p-3 rounded-2xl max-w-[80%] shadow-md text-sm">${msg}</div>`;
            chatHistory.appendChild(uDiv);
            userInput.value = '';
            chatHistory.scrollTop = chatHistory.scrollHeight;
        };
    </script>
</body>
</html>
