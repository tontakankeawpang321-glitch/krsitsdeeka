<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no, viewport-fit=cover" />
<title>Parenting Pro Mobile</title>

<!-- Preconnect for speed -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>

<!-- Fonts -->
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;500;700&family=Kodchasan:wght@500;600;700&display=swap" rel="stylesheet">
<!-- Icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

<style>
  :root {
    --primary: #FF9F43;
    --primary-soft: #fff0dc;
    --accent: #54a0ff;
    --accent-soft: #eaf4ff;
    --success: #1dd1a1;
    --bg: #f7f9fc;
    --glass: rgba(255, 255, 255, 0.95);
    --text-main: #2d3436;
    --text-muted: #636e72;
    --shadow-soft: 0 4px 20px rgba(0,0,0,0.05);
    --shadow-pop: 0 10px 30px rgba(255, 159, 67, 0.25);
    --radius-l: 20px;
    --radius-m: 14px;
    --header-h: 65px;
    
    /* Dot Colors */
    --dot-green: #2ecc71;  /* ‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç/‡∏î‡πà‡∏ß‡∏ô */
    --dot-red: #e74c3c;    /* ‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ */
    --dot-yellow: #f1c40f; /* ‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á */
    --dot-brown: #d35400;  /* ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏° */
  }

  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  
  body {
    margin: 0;
    font-family: "Sarabun", sans-serif;
    background: var(--bg);
    color: var(--text-main);
    padding-bottom: 90px;
    background-image: linear-gradient(to bottom, #fffdf7 0%, #f7f9fc 100%);
    overflow-x: hidden;
  }

  /* --- Animations --- */
  @keyframes slideUp { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
  
  /* --- Structure --- */
  .container { max-width: 100%; margin: 0 auto; padding: 0 16px; }
  
  /* --- Header --- */
  header {
    position: sticky; top: 0; z-index: 100;
    background: var(--glass);
    backdrop-filter: blur(15px);
    -webkit-backdrop-filter: blur(15px);
    border-bottom: 1px solid rgba(0,0,0,0.05);
    height: var(--header-h);
    display: flex; align-items: center;
  }
  .nav-flex { display: flex; justify-content: space-between; align-items: center; width: 100%; }
  .logo { 
    font-family: "Kodchasan", sans-serif; font-size: 20px; font-weight: 700; 
    color: var(--primary); display: flex; align-items: center; gap: 8px; white-space: nowrap;
  }
  
  .search-wrap { position: relative; width: 100%; max-width: 220px; }
  .search-wrap input {
    width: 100%; padding: 8px 12px 8px 35px; border: none; background: #f1f2f6; 
    border-radius: 50px; font-family: inherit; font-size: 16px; transition: all 0.2s;
  }
  .search-wrap input:focus { background: #fff; box-shadow: 0 0 0 2px var(--primary-soft); outline: none; }
  .search-wrap i { position: absolute; left: 12px; top: 50%; transform: translateY(-50%); color: #b2bec3; font-size: 14px; }

  /* --- Dashboard --- */
  .dashboard { display: flex; flex-direction: column; gap: 20px; margin-top: 20px; }
  @media (min-width: 900px) {
    .container { max-width: 1200px; padding: 0 24px; }
    .dashboard { display: grid; grid-template-columns: 320px 1fr; gap: 30px; }
    .search-wrap { max-width: 300px; }
    .logo { font-size: 24px; }
  }

  /* --- Profile Card --- */
  .profile-card {
    background: #fff; border-radius: var(--radius-l); padding: 16px; 
    box-shadow: var(--shadow-soft); position: relative; overflow: hidden;
    display: flex; align-items: center; gap: 15px;
  }
  .profile-bg {
    position: absolute; top: 0; left: 0; width: 100%; height: 100%;
    background: linear-gradient(135deg, #FF9F43 0%, #ff6b6b 100%); opacity: 0.1; z-index: 0; pointer-events: none;
  }
  .avatar {
    width: 60px; height: 60px; background: #fff; border-radius: 50%; flex-shrink: 0;
    position: relative; z-index: 1; border: 2px solid #fff; box-shadow: 0 2px 8px rgba(0,0,0,0.1); overflow: hidden;
  }
  .avatar img { width: 100%; height: 100%; border-radius: 50%; object-fit: cover; }
  .profile-info { flex: 1; position: relative; z-index: 1; }
  .user-name { font-weight: 700; font-size: 18px; margin: 0 0 4px; color: #d35400; }
  .baby-info { font-size: 13px; color: var(--text-muted); margin: 0; }
  .btn-edit-profile {
    background: transparent; border: 1px solid var(--primary); color: var(--primary);
    padding: 6px 12px; border-radius: 20px; font-size: 12px; font-weight: 600; cursor: pointer; position: relative; z-index: 1;
  }
  @media (min-width: 900px) {
    .profile-card { flex-direction: column; text-align: center; padding: 24px; }
    .avatar { width: 80px; height: 80px; margin-bottom: 10px; }
    .btn-edit-profile { width: 100%; margin-top: 10px; background: var(--primary); color: #fff; border:none; padding:10px; }
  }

  /* --- Calendar --- */
  .calendar-widget { background: #fff; border-radius: var(--radius-l); padding: 16px; box-shadow: var(--shadow-soft); }
  .cal-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px; font-weight: 700; font-size: 15px; }
  .cal-nav { display: flex; align-items: center; gap: 10px; }
  .cal-nav i { cursor: pointer; padding: 5px; color: var(--text-muted); transition: color 0.2s; }
  .cal-nav i:hover { color: var(--primary); }
  .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; text-align: center; font-size: 12px; }
  .cal-day-name { color: var(--text-muted); font-weight: 600; margin-bottom: 4px; font-size: 11px; }
  
  .cal-date { 
    aspect-ratio: 1; display: flex; align-items: center; justify-content: center;
    border-radius: 50%; cursor: pointer; position: relative; border: 1px solid transparent; transition: 0.2s;
    font-size: 13px; color: var(--text-main);
  }
  .cal-date.active { background: var(--primary); color: #fff; box-shadow: 0 4px 12px rgba(255, 159, 67, 0.4); z-index: 2; }
  
  /* Dots Logic */
  .cal-date::after {
    content: ''; position: absolute; bottom: 4px; width: 5px; height: 5px; border-radius: 50%; display:none;
  }
  .cal-date.type-green::after { display:block; background: var(--dot-green); }
  .cal-date.type-red::after { display:block; background: var(--dot-red); }
  .cal-date.type-yellow::after { display:block; background: var(--dot-yellow); }
  .cal-date.type-brown::after { display:block; background: var(--dot-brown); }

  /* Legend */
  .cal-legend { display:flex; gap:10px; justify-content:center; margin-top:12px; font-size:10px; color:var(--text-muted); flex-wrap:wrap; }
  .legend-item { display:flex; align-items:center; gap:4px; }
  .dot { width:6px; height:6px; border-radius:50%; }
  
  /* Timeline List inside Calendar */
  .event-list { 
    margin-top:15px; font-size:13px; color:var(--text-main); padding:16px; 
    background:#fff; border-radius:16px; border: 1px solid #f0f0f0; 
    display:none; box-shadow: 0 4px 15px rgba(0,0,0,0.03);
  }
  .event-header { display:flex; align-items:center; gap:8px; margin-bottom:10px; font-weight:700; font-size:15px; }
  .event-tag { font-size:10px; padding:2px 8px; border-radius:10px; color:#fff; font-weight:600; }
  .event-content ul { margin:0; padding-left:20px; list-style-type:circle; color:#555; }
  .event-content li { margin-bottom:6px; line-height:1.5; }

  /* --- Roadmap --- */
  .section-title { 
    font-family: "Kodchasan"; font-size: 18px; margin-bottom: 12px; 
    display: flex; align-items: center; gap: 8px; color: var(--text-main);
  }
  .section-title i { color: var(--primary); }
  .roadmap-scroll {
    display: flex; gap: 12px; overflow-x: auto; padding-bottom: 15px; margin-bottom: 20px;
    scroll-snap-type: x mandatory; -webkit-overflow-scrolling: touch; scrollbar-width: none;
  }
  .roadmap-scroll::-webkit-scrollbar { display: none; }
  .roadmap-card {
    min-width: 160px; flex: 0 0 auto; scroll-snap-align: start;
    background: #fff; border-radius: var(--radius-m); padding: 16px;
    box-shadow: var(--shadow-soft); border: 1px solid transparent;
    cursor: pointer; transition: transform 0.2s; position: relative;
  }
  .roadmap-card:active { transform: scale(0.98); }
  .roadmap-card.active { border-color: var(--primary); background: #fffcf5; }
  .roadmap-card .icon-box {
    width: 36px; height: 36px; background: var(--primary-soft); color: var(--primary);
    border-radius: 10px; display: flex; align-items: center; justify-content: center;
    font-size: 18px; margin-bottom: 10px;
  }
  .roadmap-card h4 { margin: 0 0 4px; font-size: 14px; color: #333; }
  .roadmap-card p { margin: 0; font-size: 11px; color: var(--text-muted); }

  /* --- Articles --- */
  .article-grid { display: grid; grid-template-columns: 1fr; gap: 16px; }
  @media (min-width: 600px) { .article-grid { grid-template-columns: repeat(2, 1fr); } }
  @media (min-width: 900px) { .article-grid { grid-template-columns: repeat(auto-fill, minmax(240px, 1fr)); } }
  
  .article-card {
    background: #fff; border-radius: var(--radius-m); overflow: hidden;
    box-shadow: var(--shadow-soft); display: flex; flex-direction: column;
    animation: slideUp 0.5s ease backwards;
  }
  .article-body { padding: 16px; flex: 1; display: flex; flex-direction: column; }
  .article-tags { margin-bottom: 8px; }
  .tag { font-size: 10px; padding: 2px 6px; border-radius: 4px; background: #f1f2f6; color: #636e72; display: inline-block; margin-right: 4px; }
  .article-title { font-size: 16px; font-weight: 700; margin: 0 0 8px; line-height: 1.4; color: var(--text-main); }
  .article-desc { font-size: 13px; color: var(--text-muted); margin-bottom: 12px; line-height: 1.5; display: -webkit-box; -webkit-line-clamp: 3; -webkit-box-orient: vertical; overflow: hidden; }
  .btn-read {
    margin-top: auto; align-self: flex-start;
    padding: 8px 14px; background: var(--accent-soft); color: var(--accent);
    border-radius: 8px; font-size: 12px; font-weight: 600; cursor: pointer; border: none;
  }
  .btn-read:active { background: var(--accent); color: #fff; }

  /* --- Modal --- */
  .modal-backdrop {
    position: fixed; inset: 0; background: rgba(0,0,0,0.4); backdrop-filter: blur(4px);
    z-index: 2000; display: none; place-items: center; align-items: flex-end; opacity: 0; transition: opacity 0.2s;
  }
  .modal-backdrop.show { display: flex; opacity: 1; }
  .modal-modern {
    width: 100%; max-width: 800px; max-height: 90vh; background: #fff; 
    border-radius: 24px 24px 0 0; box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.2);
    display: flex; flex-direction: column; animation: slideUp 0.3s cubic-bezier(0.1, 0.9, 0.2, 1); overflow: hidden;
  }
  @media (min-width: 600px) {
    .modal-backdrop { align-items: center; }
    .modal-modern { width: 90%; border-radius: 24px; animation: popIn 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275); }
  }
  .modal-header { padding: 16px 20px; border-bottom: 1px solid #f0f0f0; display: flex; justify-content: space-between; align-items: center; }
  .modal-title { font-family: "Kodchasan"; font-size: 18px; margin: 0; color: var(--primary); }
  .btn-close {
    background: #f8f9fa; border: none; width: 36px; height: 36px; border-radius: 50%;
    cursor: pointer; display: grid; place-items: center; color: #636e72; font-size: 16px;
  }
  .modal-content { padding: 20px; overflow-y: auto; -webkit-overflow-scrolling: touch; }

  /* --- Chat Interface --- */
  .chat-interface { display: flex; flex-direction: column; height: 100%; background: #f8f9fa; }
  .chat-messages { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 15px; }
  .chat-input-area { padding: 15px; background: #fff; border-top: 1px solid #eee; display: flex; gap: 10px; align-items: center; }
  .chat-input { flex: 1; padding: 12px 16px; border: 1px solid #eee; background:#f8f9fa; border-radius: 30px; outline: none; font-family: inherit; font-size:16px; transition:0.3s; }
  .chat-input:focus { background:#fff; border-color:var(--primary); box-shadow:0 0 0 3px var(--primary-soft); }
  .btn-send { width: 48px; height: 48px; background: var(--primary); color: #fff; border-radius: 50%; border: none; cursor: pointer; display: grid; place-items: center; font-size:18px; box-shadow:0 4px 10px rgba(255, 159, 67, 0.3); }
  
  .msg { max-width: 80%; padding: 12px 18px; border-radius: 20px; font-size: 15px; line-height: 1.5; word-wrap: break-word; }
  .msg.user { align-self: flex-end; background: var(--primary); color: #fff; border-bottom-right-radius: 4px; box-shadow: 0 4px 15px rgba(255, 159, 67, 0.2); }
  .msg.bot { align-self: flex-start; background: #fff; color: #333; border: 1px solid #eee; border-bottom-left-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.03); }
  .typing-indicator { font-size: 12px; color: #888; margin-left: 20px; margin-bottom: 10px; display: none; font-style:italic; }

  /* Chat Bubble (Articles) */
  .chat-bubble {
    background: #fff; padding: 12px 16px; border-radius: 16px; border-bottom-left-radius: 4px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.03); border: 1px solid #f1f2f6;
    margin-bottom: 12px; font-size: 14px; line-height: 1.6;
  }
  .chat-bubble.highlight { background: var(--primary-soft); border-color: transparent; border-radius: 16px; border-bottom-right-radius: 4px; align-self: flex-end; }

  /* Forms */
  .form-group { margin-bottom: 15px; }
  .form-label { display: block; margin-bottom: 5px; font-weight: 600; font-size: 14px; }
  .form-input { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 10px; font-family: inherit; font-size: 16px; }
  .btn-save { width: 100%; padding: 12px; background: var(--primary); color: #fff; border: none; border-radius: 12px; font-weight: 700; font-size: 16px; cursor: pointer; }

  /* FAB */
  .fab-ai {
    position: fixed; bottom: 20px; right: 20px; width: 56px; height: 56px;
    background: #2d3436; color: #fff; border-radius: 50%; display: flex; align-items: center; justify-content: center;
    font-size: 24px; text-decoration: none; box-shadow: 0 8px 20px rgba(0,0,0,0.3); z-index: 1000; border: none; cursor: pointer; transition: transform 0.2s;
  }
  .fab-ai:active { transform: scale(0.95); }
  .hidden { display: none !important; }
</style>
</head>
<body>

<header>
  <div class="container nav-flex">
    <div class="logo">
      <i class="fa-solid fa-baby-carriage"></i> P.Pro
    </div>
    <div class="search-wrap">
      <i class="fa-solid fa-magnifying-glass"></i>
      <input type="text" id="searchInput" placeholder="‡∏Ñ‡πâ‡∏ô‡∏´‡∏≤...">
    </div>
  </div>
</header>

<main class="container">
  
  <div class="dashboard">
    
    <!-- Left Column -->
    <aside>
      <!-- Profile Card -->
      <div class="profile-card">
        <div class="profile-bg"></div>
        <div class="avatar">
          <img id="profileImg" src="https://api.dicebear.com/7.x/avataaars/svg?seed=Felix" alt="Baby">
        </div>
        <div class="profile-info">
          <h3 id="profileName" class="user-name">‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ö‡∏∏‡∏ç</h3>
          <p id="profileAge" class="baby-info">‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡∏≠‡∏≤‡∏¢‡∏∏...</p>
        </div>
        <button class="btn-edit-profile" onclick="openEditProfile()">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç</button>
      </div>

      <!-- Calendar -->
      <div class="calendar-widget" style="margin-top:16px;">
        <div class="cal-header">
          <div class="cal-nav">
             <i class="fa-solid fa-chevron-left" onclick="prevMonth()"></i>
             <span id="monthDisplay">‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏° 2026</span>
             <i class="fa-solid fa-chevron-right" onclick="nextMonth()"></i>
          </div>
          <span style="font-size:12px; color:var(--primary); cursor:pointer;" onclick="goToToday()">‡∏ß‡∏±‡∏ô‡∏ô‡∏µ‡πâ</span>
        </div>
        <div class="cal-grid" id="calendarGrid">
          <!-- JS fills dates -->
        </div>
        <div class="cal-legend">
          <div class="legend-item"><span class="dot" style="background:var(--dot-green)"></span>‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç</div>
          <div class="legend-item"><span class="dot" style="background:var(--dot-red)"></span>‡∏£‡∏∞‡∏ß‡∏±‡∏á</div>
          <div class="legend-item"><span class="dot" style="background:var(--dot-yellow)"></span>‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á</div>
          <div class="legend-item"><span class="dot" style="background:var(--dot-brown)"></span>‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°</div>
        </div>
        <div id="eventDisplay" class="event-list"></div>
      </div>
    </aside>

    <!-- Right Column -->
    <section>
      <div class="section-title">
        <i class="fa-solid fa-map-location-dot"></i> Roadmap ‡πÄ‡∏•‡∏µ‡πâ‡∏¢‡∏á‡∏•‡∏π‡∏Å
      </div>
      
      <div class="roadmap-scroll">
        <div class="roadmap-card active" onclick="filterByAge('0-6m')">
          <div class="icon-box"><i class="fa-solid fa-bottle-droplet"></i></div>
          <h4>‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î-6‡∏î.</h4>
          <p>‡∏ô‡∏°‡πÅ‡∏°‡πà, ‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô</p>
        </div>
        <div class="roadmap-card" onclick="filterByAge('6-12m')">
          <div class="icon-box"><i class="fa-solid fa-spoon"></i></div>
          <h4>6-12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</h4>
          <p>‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏°‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏Å</p>
        </div>
        <div class="roadmap-card" onclick="filterByAge('1-2y')">
          <div class="icon-box"><i class="fa-solid fa-person-walking"></i></div>
          <h4>1-2 ‡∏Ç‡∏ß‡∏ö</h4>
          <p>‡∏´‡∏±‡∏î‡πÄ‡∏î‡∏¥‡∏ô, ‡∏û‡∏π‡∏î</p>
        </div>
        <div class="roadmap-card" onclick="filterByAge('2-3y')">
          <div class="icon-box"><i class="fa-solid fa-puzzle-piece"></i></div>
          <h4>2-3 ‡∏Ç‡∏ß‡∏ö</h4>
          <p>‡πÄ‡∏•‡∏¥‡∏Å‡πÄ‡∏û‡∏¥‡∏™</p>
        </div>
        <div class="roadmap-card" onclick="filterByAge('3-6y')">
          <div class="icon-box"><i class="fa-solid fa-school"></i></div>
          <h4>3-6 ‡∏Ç‡∏ß‡∏ö</h4>
          <p>‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏•</p>
        </div>
      </div>

      <div class="section-title" style="justify-content:space-between">
        <span><i class="fa-solid fa-book-open"></i> ‡∏ö‡∏ó‡∏Ñ‡∏ß‡∏≤‡∏°‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥</span>
        <span style="font-size:12px; color:var(--text-muted)" id="resultCount"></span>
      </div>

      <div id="gridContainer" class="article-grid"></div>
      
      <div style="display:flex; justify-content:center; gap:15px; margin-top:25px; align-items:center;">
        <button id="prevBtn" class="btn-read" style="background:#fff; border:1px solid #eee;" disabled><i class="fa-solid fa-chevron-left"></i></button>
        <span id="pageInfo" style="font-size:13px; font-weight:600; color:var(--text-muted);">1 / 1</span>
        <button id="nextBtn" class="btn-read" style="background:#fff; border:1px solid #eee;"><i class="fa-solid fa-chevron-right"></i></button>
      </div>
    </section>
  </div>
</main>

<!-- Info Modal -->
<div id="modalBackdrop" class="modal-backdrop">
  <div class="modal-modern">
    <header class="modal-header">
      <h2 id="mTitle" class="modal-title" style="white-space:nowrap; overflow:hidden; text-overflow:ellipsis; padding-right:10px;">-</h2>
      <button id="closeModal" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
    </header>
    <div class="modal-content">
      <div id="mDialogContent"></div>
      <div id="mSources" style="margin-top:20px; font-size:12px; color:#999; border-top:1px solid #eee; padding-top:10px;"></div>
    </div>
  </div>
</div>

<!-- Edit Profile Modal -->
<div id="editProfileModal" class="modal-backdrop">
  <div class="modal-modern">
    <header class="modal-header">
      <h2 class="modal-title">‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏¢</h2>
      <button onclick="closeEditProfile()" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
    </header>
    <div class="modal-content">
      <div class="form-group">
        <label class="form-label">‡∏ä‡∏∑‡πà‡∏≠‡πÄ‡∏•‡πà‡∏ô</label>
        <input type="text" id="editName" class="form-input" placeholder="‡πÄ‡∏ä‡πà‡∏ô ‡∏ô‡πâ‡∏≠‡∏á‡∏°‡∏µ‡∏ö‡∏∏‡∏ç">
      </div>
      <div class="form-group">
        <label class="form-label">‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î (‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏Ñ‡∏≥‡∏ô‡∏ß‡∏ì‡πÑ‡∏°‡∏•‡πå‡∏™‡πÇ‡∏ï‡∏ô‡πÉ‡∏ô‡∏õ‡∏è‡∏¥‡∏ó‡∏¥‡∏ô)</label>
        <input type="date" id="editDob" class="form-input">
      </div>
      <div class="form-group">
        <label class="form-label">‡∏£‡∏π‡∏õ‡πÇ‡∏õ‡∏£‡πÑ‡∏ü‡∏•‡πå</label>
        <input type="file" id="editAvatar" class="form-input" accept="image/*">
      </div>
      <button onclick="saveProfile()" class="btn-save">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
    </div>
  </div>
</div>

<!-- Chatbot AI Interface Modal -->
<div id="chatModal" class="modal-backdrop">
  <div class="modal-modern" style="height: 90vh; max-height: 90vh; display:flex; flex-direction:column;">
    <header class="modal-header" style="background:#f8f9fa; border-bottom:1px solid #ddd;">
      <h2 class="modal-title" style="display:flex; align-items:center; gap:10px;"><i class="fa-solid fa-robot" style="color:var(--primary)"></i> ‡∏ú‡∏π‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏≠‡∏±‡∏à‡∏â‡∏£‡∏¥‡∏¢‡∏∞ (AI)</h2>
      <button onclick="closeChat()" class="btn-close"><i class="fa-solid fa-xmark"></i></button>
    </header>
    <div class="chat-interface">
      <div class="chat-messages" id="chatHistory">
        <div class="msg bot">‡∏™‡∏ß‡∏±‡∏™‡∏î‡∏µ‡∏Ñ‡πà‡∏∞‡∏Ñ‡∏∏‡∏ì‡πÅ‡∏°‡πà ‡∏°‡∏µ‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á‡πÑ‡∏´‡∏ô‡πÉ‡∏´‡πâ‡∏ä‡πà‡∏ß‡∏¢‡∏î‡∏π‡πÅ‡∏•‡∏Ñ‡∏∞? üòä</div>
      </div>
      <div id="typingIndicator" class="typing-indicator">AI ‡∏Å‡∏≥‡∏•‡∏±‡∏á‡∏û‡∏¥‡∏°‡∏û‡πå...</div>
      <div class="chat-input-area">
        <input type="text" id="chatInput" class="chat-input" placeholder="‡∏û‡∏¥‡∏°‡∏û‡πå‡∏Ñ‡∏≥‡∏ñ‡∏≤‡∏°‡∏ó‡∏µ‡πà‡∏ô‡∏µ‡πà..." onkeypress="if(event.key==='Enter') sendChat()">
        <button class="btn-send" onclick="sendChat()"><i class="fa-solid fa-paper-plane"></i></button>
      </div>
    </div>
  </div>
</div>

<button onclick="openChat()" class="fab-ai"><i class="fa-solid fa-message"></i></button>

<script>
// Mock Content
const ARTICLES = [
  { "id": "inf0_01", "t": "0‚Äì6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡∏Å‡∏≤‡∏£‡πÉ‡∏´‡πâ‡∏ô‡∏°‡πÅ‡∏°‡πà", "ar": "0-6m", "tg": "‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", "c": "‡πÉ‡∏´‡πâ‡∏ô‡∏°‡πÅ‡∏°‡πà‡∏≠‡∏¢‡πà‡∏≤‡∏á‡πÄ‡∏î‡∏µ‡∏¢‡∏ß 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô‡πÅ‡∏£‡∏Å (‡∏ñ‡πâ‡∏≤‡∏ó‡∏≥‡πÑ‡∏î‡πâ). ‡∏≠‡∏∏‡πâ‡∏°‡∏Å‡∏∂‡πà‡∏á‡∏ï‡∏±‡πâ‡∏á‡∏ï‡∏£‡∏á‡πÄ‡∏™‡∏°‡∏≠. ‡∏ó‡∏≥‡πÉ‡∏´‡πâ‡πÄ‡∏£‡∏≠‡∏ó‡∏∏‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏´‡∏•‡∏±‡∏á‡∏Å‡∏¥‡∏ô.", "s": "WHO" },
  { "id": "inf0_02", "t": "0‚Äì6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡∏ô‡∏≠‡∏ô‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢ (Safe Sleep)", "ar": "0-6m", "tg": "‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢", "c": "‡∏ô‡∏≠‡∏ô‡∏´‡∏á‡∏≤‡∏¢‡∏ö‡∏ô‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô‡πÅ‡∏Ç‡πá‡∏á. ‡πÑ‡∏°‡πà‡πÅ‡∏ä‡∏£‡πå‡πÄ‡∏ï‡∏µ‡∏¢‡∏á‡∏Å‡∏±‡∏ö‡∏û‡πà‡∏≠‡πÅ‡∏°‡πà. ‡πÑ‡∏°‡πà‡∏°‡∏µ‡∏´‡∏°‡∏≠‡∏ô/‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤‡πÉ‡∏ô‡πÄ‡∏ï‡∏µ‡∏¢‡∏á.", "s": "CDC" },
  { "id": "inf0_03", "t": "0‚Äì6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: Tummy Time", "ar": "0-6m", "tg": "‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", "c": "‡∏à‡∏±‡∏ö‡∏Ñ‡∏ß‡πà‡∏≥‡πÄ‡∏•‡πà‡∏ô‡∏ï‡∏≠‡∏ô‡∏ï‡∏∑‡πà‡∏ô. ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ß‡∏±‡∏ô‡∏•‡∏∞ 1-2 ‡∏ô‡∏≤‡∏ó‡∏µ. ‡∏ä‡πà‡∏ß‡∏¢‡πÉ‡∏´‡πâ‡∏Ñ‡∏≠‡πÅ‡∏•‡∏∞‡∏´‡∏•‡∏±‡∏á‡πÅ‡∏Ç‡πá‡∏á‡πÅ‡∏£‡∏á.", "s": "Pathways" },
  { "id": "inf1_01", "t": "6‚Äì12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏Å", "ar": "6-12m", "tg": "‡πÇ‡∏†‡∏ä‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", "c": "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏Ç‡πâ‡∏≤‡∏ß‡∏ö‡∏î/‡∏ú‡∏±‡∏Å‡∏ï‡πâ‡∏° 1 ‡∏°‡∏∑‡πâ‡∏≠. ‡πÄ‡∏ó‡∏™‡∏ï‡πå‡∏Å‡∏≤‡∏£‡πÅ‡∏û‡πâ‡∏ó‡∏µ‡∏•‡∏∞‡∏≠‡∏¢‡πà‡∏≤‡∏á. ‡∏ù‡∏∂‡∏Å‡∏î‡∏∑‡πà‡∏°‡∏ô‡πâ‡∏≥‡∏à‡∏≤‡∏Å‡πÅ‡∏Å‡πâ‡∏ß.", "s": "MOPH" },
  { "id": "inf1_03", "t": "6‚Äì12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô: ‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏Ñ‡∏•‡∏≤‡∏ô", "ar": "6-12m", "tg": "‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£", "c": "‡∏à‡∏±‡∏î‡∏û‡∏∑‡πâ‡∏ô‡∏ó‡∏µ‡πà‡∏û‡∏∑‡πâ‡∏ô‡πÄ‡∏£‡∏µ‡∏¢‡∏ö‡πÉ‡∏´‡πâ‡∏Ñ‡∏•‡∏≤‡∏ô. ‡∏£‡∏∞‡∏ß‡∏±‡∏á‡∏õ‡∏•‡∏±‡πä‡∏Å‡πÑ‡∏ü‡πÅ‡∏•‡∏∞‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å. ‡∏ù‡∏∂‡∏Å‡πÄ‡∏Å‡∏≤‡∏∞‡∏¢‡∏∑‡∏ô.", "s": "CDC" },
  { "id": "tod1_01", "t": "1‚Äì2 ‡∏õ‡∏µ: ‡∏ù‡∏∂‡∏Å‡∏Ç‡∏±‡∏ö‡∏ñ‡πà‡∏≤‡∏¢ (Potty)", "ar": "1-2y", "tg": "‡∏™‡∏∏‡∏Ç‡∏≠‡∏ô‡∏≤‡∏°‡∏±‡∏¢", "c": "‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏™‡∏±‡∏ç‡∏ç‡∏≤‡∏ì‡∏ö‡∏≠‡∏Å‡∏â‡∏µ‡πà. ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡πâ‡∏ô‡∏±‡πà‡∏á‡∏Å‡∏£‡∏∞‡πÇ‡∏ñ‡∏ô‡πÄ‡∏•‡πà‡∏ô‡πÜ. ‡∏´‡πâ‡∏≤‡∏°‡∏Å‡∏î‡∏î‡∏±‡∏ô‡∏´‡∏£‡∏∑‡∏≠‡∏î‡∏∏.", "s": "AAP" },
  { "id": "tod1_02", "t": "1‚Äì2 ‡∏õ‡∏µ: ‡∏£‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡πÄ‡∏î‡πá‡∏Å‡∏Ç‡∏µ‡πâ‡πÇ‡∏°‡πÇ‡∏´", "ar": "1-2y", "tg": "‡∏à‡∏¥‡∏ï‡∏ß‡∏¥‡∏ó‡∏¢‡∏≤", "c": "‡πÄ‡∏ö‡∏µ‡πà‡∏¢‡∏á‡πÄ‡∏ö‡∏ô‡∏Ñ‡∏ß‡∏≤‡∏°‡∏™‡∏ô‡πÉ‡∏à. ‡∏Å‡∏≠‡∏î‡πÄ‡∏°‡∏∑‡πà‡∏≠‡∏™‡∏á‡∏ö‡∏•‡∏á. ‡πÉ‡∏ä‡πâ‡∏Ñ‡∏≥‡∏™‡∏±‡πà‡∏á‡∏™‡∏±‡πâ‡∏ô‡πÅ‡∏•‡∏∞‡∏ä‡∏±‡∏î‡πÄ‡∏à‡∏ô.", "s": "Positive P." },
  { "id": "pre_01", "t": "3‚Äì6 ‡∏õ‡∏µ: ‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏û‡∏£‡πâ‡∏≠‡∏°‡πÑ‡∏õ‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "ar": "3-6y", "tg": "‡πÇ‡∏£‡∏á‡πÄ‡∏£‡∏µ‡∏¢‡∏ô", "c": "‡∏ù‡∏∂‡∏Å‡∏ä‡πà‡∏ß‡∏¢‡πÄ‡∏´‡∏•‡∏∑‡∏≠‡∏ï‡∏±‡∏ß‡πÄ‡∏≠‡∏á (‡∏Å‡∏¥‡∏ô/‡πÅ‡∏ï‡πà‡∏á‡∏ï‡∏±‡∏ß). ‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏£‡∏≠‡∏Ñ‡∏≠‡∏¢. ‡∏™‡∏≠‡∏ô‡∏Å‡∏≤‡∏£‡∏ö‡∏≠‡∏Å‡∏Ñ‡∏ß‡∏≤‡∏°‡∏ï‡πâ‡∏≠‡∏á‡∏Å‡∏≤‡∏£.", "s": "Ed. Gov" }
];

// Content Generator Lists
const ACTIVITIES_ROUTINE = [
  "‡πÄ‡∏•‡πà‡∏ô‡∏à‡πä‡∏∞‡πÄ‡∏≠‡πã‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ù‡∏∂‡∏Å‡∏Å‡∏≤‡∏£‡∏Ñ‡∏á‡∏≠‡∏¢‡∏π‡πà‡∏Ç‡∏≠‡∏á‡∏ß‡∏±‡∏ï‡∏ñ‡∏∏", "‡∏≠‡πà‡∏≤‡∏ô‡∏ô‡∏¥‡∏ó‡∏≤‡∏ô‡∏†‡∏≤‡∏û‡∏Å‡πà‡∏≠‡∏ô‡∏ô‡∏≠‡∏ô", "‡∏û‡∏≤‡πÄ‡∏î‡∏¥‡∏ô‡πÄ‡∏•‡πà‡∏ô‡∏£‡∏±‡∏ö‡πÅ‡∏™‡∏á‡πÅ‡∏î‡∏î‡∏≠‡πà‡∏≠‡∏ô‡∏ï‡∏≠‡∏ô‡πÄ‡∏ä‡πâ‡∏≤", 
  "‡∏£‡πâ‡∏≠‡∏á‡πÄ‡∏û‡∏•‡∏á‡πÅ‡∏•‡∏∞‡∏ó‡∏≥‡∏ó‡πà‡∏≤‡∏ó‡∏≤‡∏á‡∏õ‡∏£‡∏∞‡∏Å‡∏≠‡∏ö", "‡∏ô‡∏ß‡∏î‡∏™‡∏±‡∏°‡∏ú‡∏±‡∏™‡∏ï‡∏±‡∏ß‡∏•‡∏π‡∏Å‡πÄ‡∏ö‡∏≤‡πÜ ‡∏´‡∏•‡∏±‡∏á‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥", "‡∏ù‡∏∂‡∏Å‡πÄ‡∏£‡∏µ‡∏¢‡∏Å‡∏ä‡∏∑‡πà‡∏≠‡∏•‡∏π‡∏Å‡πÅ‡∏•‡∏∞‡∏£‡∏≠‡∏Å‡∏≤‡∏£‡∏ï‡∏≠‡∏ö‡∏™‡∏ô‡∏≠‡∏á",
  "‡πÄ‡∏•‡πà‡∏ô‡∏Ç‡∏≠‡∏á‡πÄ‡∏•‡πà‡∏ô‡∏ó‡∏µ‡πà‡∏°‡∏µ‡∏™‡∏µ‡∏™‡∏±‡∏ô‡∏™‡∏î‡πÉ‡∏™", "‡∏ù‡∏∂‡∏Å‡∏à‡∏±‡∏ö‡∏°‡∏∑‡∏≠‡∏•‡∏π‡∏Å‡∏õ‡∏£‡∏ö‡∏°‡∏∑‡∏≠", "‡∏Ñ‡∏∏‡∏¢‡∏Å‡∏±‡∏ö‡∏•‡∏π‡∏Å‡∏î‡πâ‡∏ß‡∏¢‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏≠‡∏á‡πÄ‡∏™‡∏µ‡∏¢‡∏á‡∏™‡∏≤‡∏°"
];
const SHOPPING_LISTS = [
  "‡πÄ‡∏ä‡πá‡∏Ñ‡∏™‡∏ï‡πá‡∏≠‡∏Å‡πÅ‡∏û‡∏°‡πÄ‡∏û‡∏¥‡∏™", "‡∏ã‡∏∑‡πâ‡∏≠‡∏ó‡∏¥‡∏ä‡∏ä‡∏π‡πà‡πÄ‡∏õ‡∏µ‡∏¢‡∏Å/‡∏™‡∏≥‡∏•‡∏µ", "‡∏ï‡∏∏‡∏ô‡∏ô‡πâ‡∏≥‡∏¢‡∏≤‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡∏ß‡∏î‡∏ô‡∏°", 
  "‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ñ‡∏£‡∏µ‡∏°‡∏ó‡∏≤‡∏ú‡∏∑‡πà‡∏ô‡∏ú‡πâ‡∏≤‡∏≠‡πâ‡∏≠‡∏°", "‡∏ã‡∏∑‡πâ‡∏≠‡∏™‡∏ö‡∏π‡πà‡πÄ‡∏´‡∏•‡∏ß‡∏≠‡∏≤‡∏ö‡∏ô‡πâ‡∏≥", "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏™‡∏ö‡∏µ‡∏¢‡∏á‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡πÄ‡∏™‡∏£‡∏¥‡∏° (‡πÑ‡∏Ç‡πà, ‡∏ú‡∏±‡∏Å)"
];
const SAFETY_CHECKS = [
  "‡∏ï‡∏±‡∏î‡πÄ‡∏•‡πá‡∏ö‡∏•‡∏π‡∏Å‡πÉ‡∏´‡πâ‡∏™‡∏±‡πâ‡∏ô", "‡πÄ‡∏ä‡πá‡∏Ñ‡∏°‡∏∏‡∏°‡πÇ‡∏ï‡πä‡∏∞/‡∏ï‡∏¥‡∏î‡∏Å‡∏±‡∏ô‡∏Å‡∏£‡∏∞‡πÅ‡∏ó‡∏Å", "‡∏ã‡∏±‡∏Å‡∏ï‡∏∏‡πä‡∏Å‡∏ï‡∏≤/‡∏ú‡πâ‡∏≤‡∏õ‡∏π‡∏ó‡∏µ‡πà‡∏ô‡∏≠‡∏ô‡∏Å‡∏±‡∏ô‡πÑ‡∏£‡∏ù‡∏∏‡πà‡∏ô",
  "‡πÄ‡∏ä‡πá‡∏Ñ‡∏≠‡∏∏‡∏ì‡∏´‡∏†‡∏π‡∏°‡∏¥‡∏ô‡πâ‡∏≥‡∏Å‡πà‡∏≠‡∏ô‡∏≠‡∏≤‡∏ö", "‡πÄ‡∏Å‡πá‡∏ö‡∏Ç‡∏≠‡∏á‡∏ä‡∏¥‡πâ‡∏ô‡πÄ‡∏•‡πá‡∏Å‡πÉ‡∏´‡πâ‡∏û‡πâ‡∏ô‡∏°‡∏∑‡∏≠", "‡∏ï‡∏£‡∏ß‡∏à‡∏î‡∏π‡∏ú‡∏∑‡πà‡∏ô‡∏ï‡∏≤‡∏°‡∏Ç‡πâ‡∏≠‡∏û‡∏±‡∏ö"
];

// Milestone Data Config (Expanded)
const MILESTONES = {
  0: { type: "green", title: "üéâ ‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î", tasks: ["‡πÅ‡∏à‡πâ‡∏á‡πÄ‡∏Å‡∏¥‡∏î/‡∏™‡∏π‡∏ï‡∏¥‡∏ö‡∏±‡∏ï‡∏£", "‡∏¢‡∏∑‡πà‡∏ô‡πÄ‡∏á‡∏¥‡∏ô‡∏≠‡∏∏‡∏î‡∏´‡∏ô‡∏∏‡∏ô‡πÄ‡∏î‡πá‡∏Å‡πÅ‡∏£‡∏Å‡πÄ‡∏Å‡∏¥‡∏î", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô BCG, HB1"] },
  1: { type: "green", title: "üë∂ ‡∏Ñ‡∏£‡∏ö 1 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô HB2 (‡∏ï‡∏±‡∏ö‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö‡∏ö‡∏µ)", "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û‡∏ó‡∏±‡πà‡∏ß‡πÑ‡∏õ", "‡∏õ‡∏£‡∏∞‡πÄ‡∏°‡∏¥‡∏ô‡∏Å‡∏≤‡∏£‡∏°‡∏≠‡∏á‡πÄ‡∏´‡πá‡∏ô"] },
  2: { type: "green", title: "üë∂ ‡∏Ñ‡∏£‡∏ö 2 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô DTP-HB-Hib1", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô OPV/IPV (‡πÇ‡∏õ‡∏•‡∏¥‡πÇ‡∏≠)", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô Rota1 (‡πÇ‡∏£‡∏ï‡∏≤)"] },
  4: { type: "green", title: "üë∂ ‡∏Ñ‡∏£‡∏ö 4 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô DTP-HB-Hib2", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô OPV/IPV2", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô Rota2", "‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏û‡∏•‡∏¥‡∏Å‡∏Ñ‡∏ß‡πà‡∏≥"] },
  6: { type: "green", title: "ü•£ ‡∏Ñ‡∏£‡∏ö 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏°‡∏∑‡πâ‡∏≠‡πÅ‡∏£‡∏Å", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô DTP-HB-Hib3", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô‡πÑ‡∏Ç‡πâ‡∏´‡∏ß‡∏±‡∏î‡πÉ‡∏´‡∏ç‡πà", "‡∏ù‡∏∂‡∏Å‡∏ô‡∏±‡πà‡∏á"] },
  9: { type: "green", title: "üíâ ‡∏Ñ‡∏£‡∏ö 9-12 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô MMR1 (‡∏´‡∏±‡∏î/‡∏´‡∏±‡∏î‡πÄ‡∏¢‡∏≠‡∏£‡∏°‡∏±‡∏ô/‡∏Ñ‡∏≤‡∏á‡∏ó‡∏π‡∏°)", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô JE1 (‡πÑ‡∏Ç‡πâ‡∏™‡∏°‡∏≠‡∏á‡∏≠‡∏±‡∏Å‡πÄ‡∏™‡∏ö)", "‡∏ù‡∏∂‡∏Å‡∏¢‡∏∑‡∏ô/‡πÄ‡∏î‡∏¥‡∏ô"] },
  18: { type: "green", title: "üèÉ ‡∏Ñ‡∏£‡∏ö 1 ‡∏õ‡∏µ 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô DTP-HB-Hib4 (‡∏Å‡∏£‡∏∞‡∏ï‡∏∏‡πâ‡∏ô)", "‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô JE2", "‡∏ù‡∏∂‡∏Å‡∏û‡∏π‡∏î‡πÄ‡∏õ‡πá‡∏ô‡∏Ñ‡∏≥"] },
  30: { type: "green", title: "ü¶∑ ‡∏Ñ‡∏£‡∏ö 2 ‡∏õ‡∏µ 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô", tasks: ["‡∏ß‡∏±‡∏Ñ‡∏ã‡∏µ‡∏ô MMR2", "‡∏û‡∏ö‡∏ó‡∏±‡∏ô‡∏ï‡πÅ‡∏û‡∏ó‡∏¢‡πå‡∏ó‡∏∏‡∏Å 6 ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô"] },
  36: { type: "green", title: "üè´ ‡∏Ñ‡∏£‡∏ö 3 ‡∏õ‡∏µ", tasks: ["‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡πÄ‡∏Ç‡πâ‡∏≤‡∏≠‡∏ô‡∏∏‡∏ö‡∏≤‡∏• 1", "‡∏ù‡∏∂‡∏Å‡πÄ‡∏Ç‡πâ‡∏≤‡∏´‡πâ‡∏≠‡∏á‡∏ô‡πâ‡∏≥‡πÄ‡∏≠‡∏á", "‡πÄ‡∏•‡∏¥‡∏Å‡∏Ç‡∏ß‡∏î‡∏ô‡∏°‡πÄ‡∏î‡πá‡∏î‡∏Ç‡∏≤‡∏î"] },
  72: { type: "green", title: "üéí ‡∏Ñ‡∏£‡∏ö 6 ‡∏õ‡∏µ", tasks: ["‡πÄ‡∏Ç‡πâ‡∏≤‡∏õ‡∏£‡∏∞‡∏ñ‡∏°‡∏®‡∏∂‡∏Å‡∏©‡∏≤‡∏õ‡∏µ‡∏ó‡∏µ‡πà 1", "‡∏ï‡∏£‡∏ß‡∏à‡∏™‡∏≤‡∏¢‡∏ï‡∏≤/‡∏Å‡∏≤‡∏£‡πÑ‡∏î‡πâ‡∏¢‡∏¥‡∏ô"] }
};

// Global Logic
let renderCalendar; 
let currentDisplayDate = new Date(); // State for calendar nav

document.addEventListener('DOMContentLoaded', () => {
  // DOM Refs
  const grid = document.getElementById('gridContainer');
  const modalBackdrop = document.getElementById('modalBackdrop');
  const searchInput = document.getElementById('searchInput');
  const monthDisplay = document.getElementById('monthDisplay');
  const eventDisplay = document.getElementById('eventDisplay');
  const calendarGrid = document.getElementById('calendarGrid');

  // Profile Elements
  const profileNameEl = document.getElementById('profileName');
  const profileAgeEl = document.getElementById('profileAge');
  const profileImgEl = document.getElementById('profileImg');

  // --- 1. Smart Advice Logic (Task Generator) ---
  function calculateAge(dobStr) {
    if(!dobStr) return "‡∏¢‡∏±‡∏á‡πÑ‡∏°‡πà‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î";
    const dob = new Date(dobStr);
    const now = new Date();
    const diffTime = Math.abs(now - dob);
    const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)); 
    let years = now.getFullYear() - dob.getFullYear();
    let months = now.getMonth() - dob.getMonth();
    let days = now.getDate() - dob.getDate();
    if (days < 0) { months--; days += 30; }
    if (months < 0) { years--; months += 12; }
    if(years > 0) return `${years} ‡∏Ç‡∏ß‡∏ö ${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô`;
    return `${months} ‡πÄ‡∏î‡∏∑‡∏≠‡∏ô ${days} ‡∏ß‡∏±‡∏ô`;
  }

  function getDailyAdvice(dobStr, targetDate) {
    if(!dobStr) return { type: 'brown', title: "‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡∏õ‡∏£‡∏∞‡∏à‡∏≥‡∏ß‡∏±‡∏ô", tasks: ["‡πÇ‡∏õ‡∏£‡∏î‡∏£‡∏∞‡∏ö‡∏∏‡∏ß‡∏±‡∏ô‡πÄ‡∏Å‡∏¥‡∏î‡∏•‡∏π‡∏Å‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏£‡∏±‡∏ö‡∏Ñ‡∏≥‡πÅ‡∏ô‡∏∞‡∏ô‡∏≥‡∏ó‡∏µ‡πà‡πÅ‡∏°‡πà‡∏ô‡∏¢‡∏≥"] };
    
    const dob = new Date(dobStr);
    dob.setHours(0,0,0,0);
    targetDate.setHours(0,0,0,0);
    
    // Calculate Age Difference
    const diffTime = targetDate.getTime() - dob.getTime();
    const ageInDays = Math.floor(diffTime / (1000 * 3600 * 24));
    
    // Future date or Pre-birth
    if (ageInDays < 0) return { type: 'brown', title: "‡∏£‡∏≠‡∏û‡∏ö‡∏´‡∏ô‡πâ‡∏≤‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏¢", tasks: ["‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ç‡∏≠‡∏á‡πÉ‡∏ä‡πâ‡πÄ‡∏î‡πá‡∏Å‡∏≠‡πà‡∏≠‡∏ô", "‡∏û‡∏±‡∏Å‡∏ú‡πà‡∏≠‡∏ô‡πÉ‡∏´‡πâ‡πÄ‡∏û‡∏µ‡∏¢‡∏á‡∏û‡∏≠", "‡∏à‡∏±‡∏î‡∏Å‡∏£‡∏∞‡πÄ‡∏õ‡πã‡∏≤‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏Ñ‡∏•‡∏≠‡∏î"] };
    
    // 1. Check Major Milestones (Green - Priority)
    // Check approximate months
    let ageInMonths = Math.floor(ageInDays / 30);
    const isMonthVersary = Math.abs(targetDate.getDate() - dob.getDate()) < 2; // Close to the date
    
    if (isMonthVersary && MILESTONES[ageInMonths]) {
      return { 
        type: 'green', 
        title: MILESTONES[ageInMonths].title, 
        tasks: MILESTONES[ageInMonths].tasks 
      };
    }
    
    // 2. Weekly Stock Check (Yellow - Shopping)
    // Every Sunday or every 7th day
    if (ageInDays % 7 === 0) {
      return {
        type: 'yellow',
        title: "üõí ‡∏ß‡∏±‡∏ô‡πÄ‡∏ä‡πá‡∏Ñ‡∏Ç‡∏≠‡∏á/‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á",
        tasks: [
          SHOPPING_LISTS[ageInDays % SHOPPING_LISTS.length],
          "‡πÄ‡∏ä‡πá‡∏Ñ‡πÇ‡∏õ‡∏£‡πÇ‡∏°‡∏ä‡∏±‡πà‡∏ô‡∏ô‡∏°/‡∏ú‡πâ‡∏≤‡∏≠‡πâ‡∏≠‡∏°",
          "‡πÄ‡∏ï‡∏£‡∏µ‡∏¢‡∏°‡∏≠‡∏≤‡∏´‡∏≤‡∏£‡∏™‡∏î‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö‡∏™‡∏±‡∏õ‡∏î‡∏≤‡∏´‡πå‡∏´‡∏ô‡πâ‡∏≤"
        ]
      };
    }
    
    // 3. Safety Check (Red - Caution)
    // Every 10 days
    if (ageInDays % 10 === 5) {
       return {
         type: 'red',
         title: "üõ°Ô∏è ‡∏ï‡∏£‡∏ß‡∏à‡∏Ñ‡∏ß‡∏≤‡∏°‡∏õ‡∏•‡∏≠‡∏î‡∏†‡∏±‡∏¢/‡∏™‡∏∏‡∏Ç‡∏†‡∏≤‡∏û",
         tasks: [
           SAFETY_CHECKS[ageInDays % SAFETY_CHECKS.length],
           "‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏™‡∏µ‡∏≠‡∏∂/‡∏õ‡∏±‡∏™‡∏™‡∏≤‡∏ß‡∏∞‡∏•‡∏π‡∏Å",
           "‡∏•‡πâ‡∏≤‡∏á‡∏à‡∏°‡∏π‡∏Å‡∏ñ‡πâ‡∏≤‡∏°‡∏µ‡∏ô‡πâ‡∏≥‡∏°‡∏π‡∏Å"
         ]
       };
    }
    
    // 4. Daily Routine (Brown - Activity)
    // Default for other days
    return {
      type: 'brown',
      title: "üß∏ ‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°‡πÅ‡∏•‡∏∞‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£",
      tasks: [
        ACTIVITIES_ROUTINE[ageInDays % ACTIVITIES_ROUTINE.length],
        "‡πÇ‡∏≠‡∏ö‡∏Å‡∏≠‡∏î‡∏ö‡∏≠‡∏Å‡∏£‡∏±‡∏Å‡∏•‡∏π‡∏Å",
        "‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏û‡∏±‡∏í‡∏ô‡∏≤‡∏Å‡∏≤‡∏£‡∏•‡∏á‡∏™‡∏°‡∏∏‡∏î"
      ]
    };
  }

  // --- 2. Calendar Render & Navigation ---
  window.prevMonth = () => {
    currentDisplayDate.setMonth(currentDisplayDate.getMonth() - 1);
    renderCalendar();
  };
  window.nextMonth = () => {
    currentDisplayDate.setMonth(currentDisplayDate.getMonth() + 1);
    renderCalendar();
  };
  window.goToToday = () => {
    currentDisplayDate = new Date();
    renderCalendar();
  };

  renderCalendar = () => {
    const dob = localStorage.getItem('ppro_dob');
    const today = new Date(); 
    
    const displayYear = currentDisplayDate.getFullYear();
    const displayMonth = currentDisplayDate.getMonth();

    const thMonth = ["‡∏°.‡∏Ñ.", "‡∏Å.‡∏û.", "‡∏°‡∏µ.‡∏Ñ.", "‡πÄ‡∏°.‡∏¢.", "‡∏û.‡∏Ñ.", "‡∏°‡∏¥.‡∏¢.", "‡∏Å.‡∏Ñ.", "‡∏™.‡∏Ñ.", "‡∏Å.‡∏¢.", "‡∏ï.‡∏Ñ.", "‡∏û.‡∏¢.", "‡∏ò.‡∏Ñ."];
    monthDisplay.innerText = `${thMonth[displayMonth]} ${displayYear + 543}`;
    
    calendarGrid.innerHTML = `
      <div class="cal-day-name">‡∏≠‡∏≤</div><div class="cal-day-name">‡∏à</div><div class="cal-day-name">‡∏≠</div>
      <div class="cal-day-name">‡∏û</div><div class="cal-day-name">‡∏û‡∏§</div><div class="cal-day-name">‡∏®</div>
      <div class="cal-day-name">‡∏™</div>
    `;

    const daysInM = new Date(displayYear, displayMonth + 1, 0).getDate();
    const startDay = new Date(displayYear, displayMonth, 1).getDay();
    
    for(let i=0; i<startDay; i++) calendarGrid.appendChild(document.createElement('div'));
    
    for(let i=1; i<=daysInM; i++) {
      const el = document.createElement('div');
      el.className = 'cal-date';
      el.innerText = i;
      
      const thisDate = new Date(displayYear, displayMonth, i);
      
      // Highlight "Real" Today
      if(i === today.getDate() && displayMonth === today.getMonth() && displayYear === today.getFullYear()) {
        el.classList.add('active');
      }

      // Generate Advice Content
      const advice = getDailyAdvice(dob, thisDate);
      if(advice) {
        el.classList.add(`type-${advice.type}`);
      }
      
      el.onclick = () => {
        document.querySelectorAll('.cal-date').forEach(d => {
            if(!d.classList.contains('active')) { 
                d.style.background = ''; d.style.color = '';
            }
        });
        
        if(!el.classList.contains('active')) {
          el.style.background = '#eee'; el.style.color = 'var(--text-main)';
        }

        if(advice) {
          eventDisplay.style.display = 'block';
          // Color coding badge
          let badgeColor = 'var(--dot-brown)';
          let badgeText = '‡∏Å‡∏¥‡∏à‡∏Å‡∏£‡∏£‡∏°';
          if(advice.type === 'green') { badgeColor = 'var(--dot-green)'; badgeText = '‡∏î‡πà‡∏ß‡∏ô/‡∏™‡∏≥‡∏Ñ‡∏±‡∏ç'; }
          if(advice.type === 'red') { badgeColor = 'var(--dot-red)'; badgeText = '‡∏£‡∏∞‡∏ß‡∏±‡∏á'; }
          if(advice.type === 'yellow') { badgeColor = 'var(--dot-yellow)'; badgeText = '‡∏ã‡∏∑‡πâ‡∏≠‡∏Ç‡∏≠‡∏á'; }

          eventDisplay.innerHTML = `
            <div class="event-header">
              <span class="event-tag" style="background:${badgeColor}">${badgeText}</span>
              ${advice.title}
            </div>
            <div class="event-content">
              <ul>${advice.tasks.map(t => `<li>${t}</li>`).join('')}</ul>
            </div>
          `;
        }
      };
      calendarGrid.appendChild(el);
    }
    
    if(dob) profileAgeEl.innerText = calculateAge(dob);
  };

  function loadProfile() {
    const savedName = localStorage.getItem('ppro_name');
    const savedDob = localStorage.getItem('ppro_dob');
    const savedAvatar = localStorage.getItem('ppro_avatar');

    if(savedName) profileNameEl.innerText = savedName;
    if(savedDob) profileAgeEl.innerText = calculateAge(savedDob);
    if(savedAvatar) profileImgEl.src = savedAvatar;
    
    renderCalendar(); 
  }

  // --- 3. Profile Actions ---
  window.openEditProfile = () => {
    document.getElementById('editName').value = localStorage.getItem('ppro_name') || '';
    document.getElementById('editDob').value = localStorage.getItem('ppro_dob') || '';
    document.getElementById('editProfileModal').classList.add('show');
  };
  window.closeEditProfile = () => {
    document.getElementById('editProfileModal').classList.remove('show');
  };
  window.saveProfile = () => {
    const name = document.getElementById('editName').value;
    const dob = document.getElementById('editDob').value;
    const file = document.getElementById('editAvatar').files[0];

    if(name) localStorage.setItem('ppro_name', name);
    if(dob) localStorage.setItem('ppro_dob', dob);

    if(file) {
      const reader = new FileReader();
      reader.onloadend = () => {
        localStorage.setItem('ppro_avatar', reader.result);
        loadProfile();
        closeEditProfile();
      };
      reader.readAsDataURL(file);
    } else {
      loadProfile();
      closeEditProfile();
    }
  };

  // --- 4. Articles Logic ---
  let currentPage = 1;
  const PAGE_SIZE = 6;
  let currentFilter = 'all';
  let searchTerm = '';

  window.filterByAge = (age) => {
    currentFilter = age;
    currentPage = 1;
    document.querySelectorAll('.roadmap-card').forEach(c => c.classList.remove('active'));
    event.currentTarget.classList.add('active');
    renderArticles();
  };

  const renderArticles = () => {
    const filtered = ARTICLES.filter(x => {
      const matchAge = currentFilter === 'all' || x.ar === currentFilter;
      const matchSearch = !searchTerm || x.t.toLowerCase().includes(searchTerm) || x.tg.includes(searchTerm);
      return matchAge && matchSearch;
    });

    const total = filtered.length;
    const maxPage = Math.ceil(total / PAGE_SIZE) || 1;
    if(currentPage > maxPage) currentPage = maxPage;
    const start = (currentPage - 1) * PAGE_SIZE;
    const show = filtered.slice(start, start + PAGE_SIZE);

    document.getElementById('resultCount').innerText = `${total} ‡∏£‡∏≤‡∏¢‡∏Å‡∏≤‡∏£`;
    gridContainer.innerHTML = show.map(item => `
      <div class="article-card" onclick="openModal('${item.id}')">
        <div class="article-body">
          <div class="article-tags"><span class="tag">${item.tg}</span></div>
          <h3 class="article-title">${item.t}</h3>
          <p class="article-desc">${item.c}</p>
          <div class="btn-read" style="align-self:flex-start; margin-top:auto;">‡∏≠‡πà‡∏≤‡∏ô‡∏ï‡πà‡∏≠</div>
        </div>
      </div>
    `).join('');

    document.getElementById('pageInfo').innerText = `${currentPage} / ${maxPage}`;
    document.getElementById('prevBtn').disabled = currentPage <= 1;
    document.getElementById('nextBtn').disabled = currentPage >= maxPage;
  };

  // --- 5. Modal & Chat Logic ---
  window.openModal = (id) => {
    const item = ARTICLES.find(x => x.id === id);
    if(!item) return;
    document.getElementById('mTitle').innerText = item.t;
    const lines = item.c.split('.').filter(x=>x.trim());
    let html = `<div class="chat-bubble">üëã ‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÄ‡∏£‡∏∑‡πà‡∏≠‡∏á <strong>${item.t}</strong> ‡∏Ñ‡πà‡∏∞</div>`;
    lines.forEach((l,i) => {
      html += `<div class="chat-bubble" style="animation:slideUp 0.3s backwards ${i*0.1}s">${l.trim()}.</div>`;
    });
    html += `<div class="chat-bubble highlight">üí° ‡πÄ‡∏Ñ‡∏•‡πá‡∏î‡∏•‡∏±‡∏ö: ‡∏™‡∏±‡∏á‡πÄ‡∏Å‡∏ï‡∏•‡∏π‡∏Å‡∏ô‡πâ‡∏≠‡∏¢‡πÄ‡∏õ‡πá‡∏ô‡∏´‡∏•‡∏±‡∏Å‡∏ô‡∏∞‡∏Ñ‡∏∞</div>`;
    document.getElementById('mDialogContent').innerHTML = html;
    document.getElementById('mSources').innerText = `‡∏≠‡πâ‡∏≤‡∏á‡∏≠‡∏¥‡∏á: ${item.s}`;
    modalBackdrop.classList.add('show');
    document.body.style.overflow = 'hidden';
  };
  const closeModal = () => { modalBackdrop.classList.remove('show'); document.body.style.overflow = ''; };
  document.getElementById('closeModal').onclick = closeModal;
  modalBackdrop.onclick = (e) => { if(e.target===modalBackdrop) closeModal(); };

  // Chat
  const chatHistory = document.getElementById('chatHistory');
  const chatInput = document.getElementById('chatInput');
  const typingIndicator = document.getElementById('typingIndicator');
  const API_URL = 'https://shy-fog-aa02.tontakankeawpang321.workers.dev/';

  window.openChat = () => { 
    document.getElementById('chatModal').classList.add('show'); 
    document.body.style.overflow = 'hidden'; 
    setTimeout(() => chatInput.focus(), 300);
  }
  window.closeChat = () => { 
    document.getElementById('chatModal').classList.remove('show'); 
    document.body.style.overflow = ''; 
  }
  window.sendChat = async () => {
    const text = chatInput.value.trim();
    if(!text) return;
    addMessage(text, 'user');
    chatInput.value = '';
    typingIndicator.style.display = 'block';
    try {
      const response = await fetch(API_URL, {
        method: 'POST', headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ message: text })
      });
      if (!response.ok) throw new Error('Network response was not ok');
      const data = await response.json();
      const replyText = data.reply || data.response || data.answer || data.message || JSON.stringify(data);
      addMessage(replyText, 'bot');
    } catch (error) {
      addMessage("‡∏Ç‡∏≠‡∏≠‡∏†‡∏±‡∏¢‡∏Ñ‡πà‡∏∞ ‡∏£‡∏∞‡∏ö‡∏ö‡∏Ç‡∏±‡∏î‡∏Ç‡πâ‡∏≠‡∏á‡∏ä‡∏±‡πà‡∏ß‡∏Ñ‡∏£‡∏≤‡∏ß ‡∏•‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà‡∏≠‡∏µ‡∏Å‡∏Ñ‡∏£‡∏±‡πâ‡∏á‡∏ô‡∏∞‡∏Ñ‡∏∞ üôè", 'bot');
    } finally {
      typingIndicator.style.display = 'none';
    }
  };
  function addMessage(text, sender) {
    const msgDiv = document.createElement('div');
    msgDiv.className = `msg ${sender}`;
    msgDiv.innerText = text;
    chatHistory.appendChild(msgDiv);
    chatHistory.scrollTop = chatHistory.scrollHeight;
  }

  // --- Init ---
  searchInput.oninput = (e) => { searchTerm = e.target.value.toLowerCase(); currentPage=1; renderArticles(); };
  document.getElementById('prevBtn').onclick = () => { if(currentPage>1) currentPage--; renderArticles(); };
  document.getElementById('nextBtn').onclick = () => { currentPage++; renderArticles(); };
  
  loadProfile();
  renderArticles();
});
</script>
</body>
</html>
