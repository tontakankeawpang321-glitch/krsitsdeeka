<!DOCTYPE html>
<html lang="th">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
<title>รายชื่อยารักษาโรค – จากชีต</title>

<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&family=Kodchasan:wght@600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#fffdf7; --paper:#ffffff; --ink:#0f172a; --muted:#475569; --line:#e5e7eb;
    --brand:#50b5a5; --brand-2:#2f8f80; --chip:#e6fffb; --ring:#c7f5ef;
    --ok:#16a34a; --danger:#dc2626; --radius:16px;
    --shadow:0 10px 30px -18px rgba(2,8,23,.28);
  }
  *{box-sizing:border-box}
  html,body{margin:0; background:var(--bg); color:var(--ink); font-family:"Sarabun", system-ui, -apple-system, "Segoe UI", Roboto, "Noto Sans Thai", sans-serif;}
  a{color:#0ea5e9; text-decoration:none}
  a:hover{text-decoration:underline}

  /* ล็อกสกอร์เมื่อมี modal */
  body.no-scroll{ overflow:hidden; }

  .wrap{max-width:1100px; margin:auto; padding:24px 16px 80px}
  header.app{
    position:sticky; top:0; z-index:50; backdrop-filter:blur(10px);
    background:linear-gradient(180deg, rgba(255,253,247,.85), rgba(255,253,247,.65) 60%, rgba(255,253,247,0));
    padding:18px 16px 10px; margin:0 -16px; border-bottom:1px solid rgba(0,0,0,.04);
  }
  .title{
    font-family:"Kodchasan","Sarabun",sans-serif; font-weight:700; letter-spacing:.2px;
    display:flex; align-items:center; gap:12px; margin-bottom:10px; padding:0 16px; color:#0b3b34;
  }
  .badge{
    display:inline-flex; align-items:center; gap:6px;
    background:linear-gradient(145deg,var(--brand),#9fe7dc);
    color:#053c34; padding:6px 10px; border-radius:999px; font-weight:700; font-size:12px;
    box-shadow:inset 0 1px 0 #fff, 0 2px 10px rgba(2,143,128,.25);
  }

  /* Controls */
  .controls{ display:flex; gap:10px; align-items:center; padding:8px 16px 0; flex-wrap:wrap;}
  .controls .field{ position:relative; flex:1 1 240px; }
  .controls input[type="search"], .controls select{
    width:100%; height:42px; border-radius:12px; border:1px solid var(--line); background:var(--paper);
    padding:0 12px; font-size:15px; outline:none;
  }
  .controls button{
    height:42px; border-radius:12px; border:1px solid #67dacb; cursor:pointer;
    padding:0 14px; font-weight:800; letter-spacing:.2px;
    background:linear-gradient(145deg,#ddfff8,#baf3ea); color:#064e43;
    box-shadow:inset 0 1px 0 #fff, 0 10px 24px -14px rgba(2,143,128,.45);
    transition:transform .06s, background .18s;
  }
  .controls button:hover{ background:linear-gradient(145deg,#c9fbf0,#9eeadf); }
  .controls button:active{ transform:translateY(1px); }

  /* Grid */
  .grid{ display:grid; gap:14px; padding:14px 0; grid-template-columns: repeat(12,1fr); }
  .card{
    grid-column: span 4; background:var(--paper); border:1px solid var(--line); border-radius:var(--radius);
    padding:14px; box-shadow:var(--shadow); display:flex; flex-direction:column; gap:10px;
    transition:transform .18s ease, box-shadow .18s ease;
  }
  .card:hover{ transform:translateY(-2px); box-shadow:0 14px 40px -18px rgba(2,8,23,.36);}
  @media (max-width:1000px){ .card{grid-column: span 6;} }    /* 2 คอลัมน์ */
  @media (max-width:640px){ .card{grid-column: span 6;} }     /* มือถือยังคง 2 คอลัมน์ */
  @media (max-width:400px){ .card{grid-column: span 12;} }    /* จอเล็กมาก เหลือ 1 คอลัมน์ */

  .drug-name{ margin:0; font-size:18px; line-height:1.35; display:flex; gap:8px; align-items:center; font-weight:700;}
  .generic{ font-size:14px; color:#0b3b34; font-weight:700; }

  .meta{ display:flex; gap:8px; flex-wrap:wrap; font-size:12px;}
  .pill{ background:#f8fafc; border:1px solid var(--line); border-radius:999px; padding:4px 8px; }
  .tags{ display:flex; gap:6px; flex-wrap:wrap; }
  .tag{ font-size:12px; background:#ecfeff; color:#064e43; padding:4px 8px; border-radius:999px; border:1px solid #a5f3fc; }
  .excerpt{ color:#334155; font-size:14px; line-height:1.55; display:-webkit-box; -webkit-line-clamp:3; -webkit-box-orient:vertical; overflow:hidden; }

  .btn{
    align-self:flex-start; margin-top:auto; display:inline-flex; align-items:center; gap:8px; font-weight:800; letter-spacing:.2px;
    padding:10px 14px; border-radius:12px; border:1px solid #67dacb;
    background:linear-gradient(145deg,#ddfff8,#baf3ea); color:#064e43; cursor:pointer;
    transition:transform .06s, box-shadow .18s, background .2s; box-shadow:inset 0 1px 0 #fff, 0 10px 24px -14px rgba(2,143,128,.45);
  }
  .btn:hover{ background:linear-gradient(145deg,#c9fbf0,#9eeadf); }
  .btn:active{ transform:translateY(1px); }

  /* Pagination */
  .pager{ display:flex; align-items:center; gap:8px; justify-content:center; padding:12px 0 34px;}
  .pager button{ border:1px solid var(--line); background:var(--paper); border-radius:999px; padding:8px 12px; cursor:pointer; }
  .pager .info{ font-size:13px; color:var(--muted); padding:0 8px; }

  /* Modal */
  .modal-backdrop{
    position:fixed; inset:0; background:rgba(0,0,0,.42); display:none; place-items:center; padding:16px; z-index:100;
    touch-action:none; /* ป้องกันสกอร์หน้าใต้ modal บนอุปกรณ์สัมผัส */
  }
  .modal{
    max-width:920px; width:100%; max-height:88vh; overflow:auto;
    background:var(--paper); border-radius:20px; border:1px solid var(--line); box-shadow:0 30px 80px rgba(0,0,0,.35);
  }
  .modal header{
    position:sticky; top:0; background:linear-gradient(180deg,#fff,rgba(255,255,255,.92));
    padding:16px 18px; border-bottom:1px solid var(--line); display:flex; justify-content:space-between; align-items:center; gap:10px;
  }
  .modal .body{ padding:18px; }
  .modal h2{ margin:0 0 8px; font-size:22px; }
  .close{ border:none; background:#111; color:#fff; border-radius:12px; padding:8px 12px; cursor:pointer; }
  .srcs{ margin-top:14px; font-size:14px; color:#475569; }
  .srcs a{ word-break:break-all }

  .modal-backdrop.show{ display:grid; }
  .content-html img{ max-width:100%; height:auto; border-radius:12px; }
  .content-html table{ border-collapse:collapse; width:100%; }
  .content-html table, .content-html th, .content-html td{ border:1px solid #ddd; }
  .content-html th, .content-html td{ padding:8px; }

  .skeleton{ background:linear-gradient(90deg, #f6f7f9 25%, #eceff3 37%, #f6f7f9 63%); animation:shimmer 1.2s infinite; }
  @keyframes shimmer{ 0%{background-position:-200px 0} 100%{background-position:200px 0} }

  /* ====== สีข้อความตามหมวดหมู่ยา ====== */
  .cat-analgesic .drug-name{ color:#b45309 }      
  .cat-antipyretic .drug-name{ color:#2563eb }   
  .cat-antibiotic .drug-name{ color:#dc2626 }    
  .cat-antihistamine .drug-name{ color:#0f766e } 
  .cat-antacid .drug-name{ color:#7c3aed }        
  .cat-cough .drug-name{ color:#1e40af }         
  .cat-vitamin .drug-name{ color:#166534 }       
</style>
</head>
<body>
  <header class="app">
    <div class="wrap" style="padding:0">
      <div class="title">
        <span class="badge">ฐานข้อมูล</span>
        <div style="font-size:20px">ยารักษาโรค</div>
      </div>

      <div class="controls" aria-label="เครื่องมือค้นหาและตัวกรอง">
        <div class="field"><input id="q" type="search" placeholder="ค้นหาชื่อยา / ชื่อสามัญ / อาการ ..."></div>
        <div class="field">
          <select id="cat" aria-label="เลือกหมวดยา">
            <option value="">— ทุกหมวด —</option>
            <option value="analgesic">ยาแก้ปวด</option>
            <option value="antipyretic">ยาลดไข้</option>
            <option value="antibiotic">ยาฆ่าเชื้อ</option>
            <option value="antihistamine">ยาแก้แพ้</option>
            <option value="antacid">ยาลดกรด/กระเพาะ</option>
            <option value="cough">ยาแก้ไอ/ขับเสมหะ</option>
            <option value="vitamin">วิตามิน/อาหารเสริม</option>
          </select>
        </div>
        <button id="searchBtn">ค้นหา</button>
        <button id="clearBtn" title="ล้างตัวกรอง">ล้าง</button>
      </div>
    </div>
  </header>

  <main class="wrap" id="mainContent">
    <section id="grid" class="grid"></section>
    <div class="pager" role="navigation" aria-label="เพจจิเนชัน">
      <button id="prevBtn">ย้อนกลับ</button>
      <span class="info" id="pageInfo"></span>
      <button id="nextBtn">ถัดไป</button>
    </div>
  </main>

  <div id="modalBackdrop" class="modal-backdrop" role="dialog" aria-modal="true" aria-labelledby="mTitle">
    <div class="modal">
      <header>
        <h2 id="mTitle">—</h2>
        <button id="closeModal" class="close" aria-label="ปิดหน้าต่าง">ปิด</button>
      </header>
      <div class="body">
        <div class="meta" id="mMeta"></div>
        <div class="content-html" id="mContent"></div>
        <div class="srcs" id="mSources"></div>
      </div>
    </div>
  </div>

<script>
/** ================== CONFIG ================== **/
// !!! กรุณาเปลี่ยน URL ด้านล่างนี้เป็น Raw URL ของไฟล์ JSON บน GitHub ของคุณ !!!
const API_JSON_URL = '--- URL ของไฟล์ JSON บน GITHUB ---';
const PAGE_SIZE = 12; // เพิ่มจำนวนรายการต่อหน้า

/** =============== Utilities =============== **/
const $$ = (sel, el=document)=>el.querySelector(sel);
const escapeHtml = (s='') =>
  String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c]));
const stripHtml = (html='') => { const t=document.createElement('div'); t.innerHTML=html; return t.textContent||t.innerText||''; };

/** หมวดไทย -> key (ให้สีหัวเรื่อง) */
const CAT_TH_TO_KEY = {
  'ยาแก้ปวด': 'analgesic',
  'ยาลดไข้': 'antipyretic',
  'ยาฆ่าเชื้อ': 'antibiotic',
  'ยาแก้แพ้': 'antihistamine',
  'ยาลดกรด/กระเพาะ': 'antacid',
  'ยาแก้ไอ/ขับเสมหะ': 'cough',
  'วิตามิน/อาหารเสริม': 'vitamin'
};

/** รองรับ 2 สคีมา → รวมให้อยู่รูปเดียวที่หน้าเว็บใช้ */
function normalizeDrug(x={}){
  // full-schema
  if (x.name || x.generic || x.category || x.contentHtml) {
    return {
      id: String(x.id || ''),
      name: String(x.name || ''),
      generic: String(x.generic || ''),
      category: String(x.category || ''),
      descHtml: String(x.contentHtml || ''),
      caution: String(x.caution || ''),
      sources: Array.isArray(x.sources) ? x.sources : String(x.sources||'').split(/[|,;]+/).map(s=>s.trim()).filter(Boolean),
      updatedAt: String(x.updatedAt || '')
    };
  }

  // slim-schema (ภาษาไทย)
  const thaiName = x['ชื่อยา'];
  const thaiCat = x['หมวด'];
  const thaiDesc = x['รายละเอียดยาแบบพอเข้าใจ'];
  const thaiCaution = x['คำเตือนคำแนะนำ'];
  const thaiSrc = x['อ้างอิง url'];

  const key = CAT_TH_TO_KEY[thaiCat] || (String(thaiCat||'').toLowerCase()) || '';
  return {
    id: String(x.id || ''), // อาจว่างใน slim
    name: String(thaiName || ''),
    generic: '',
    category: key, // ใช้ key เพื่อให้ class สีทำงาน
    descHtml: escapeHtml(String(thaiDesc || '')).replace(/\n/g, '<br>'), // เปลี่ยน \n เป็น <br>
    caution: String(thaiCaution || ''),
    sources: String(thaiSrc||'').split(/[|,;]+/).map(s=>s.trim()).filter(Boolean),
    updatedAt: ''
  };
}

/** =============== Fetch =============== **/
async function fetchData(){
  const res = await fetch(API_JSON_URL, {cache:'no-store'});
  if(!res.ok) throw new Error(`โหลดข้อมูลไม่ได้ (status: ${res.status})`);
  const json = await res.json();
  const arr = Array.isArray(json) ? json : (Array.isArray(json.data) ? json.data : []);
  // กรองรายการที่ไม่มีชื่อยาออก
  return arr.map(normalizeDrug).filter(drug => drug.name && drug.name.trim() !== '');
}

/** =============== State/Render =============== **/
let raw = [];
let view = [];
let page = 1;

function renderPage(){
  const total = view.length;
  const totalPages = Math.max(1, Math.ceil(total / PAGE_SIZE));
  page = Math.min(Math.max(1, page), totalPages);

  const start = (page-1)*PAGE_SIZE;
  const cur = view.slice(start, start+PAGE_SIZE);

  const g = document.getElementById('grid');
  if(!cur.length){
    g.innerHTML = `<div style="grid-column:1/-1; text-align:center; color:#475569; padding:24px">ไม่พบรายการยา</div>`;
  }else{
    g.innerHTML = cur.map(it=>{
      const catClass = it.category ? ` cat-${escapeHtml(it.category)}` : '';
      const excerpt = stripHtml(it.descHtml || '').slice(0,180);
      const srcs = (it.sources||[]).length ? `<div class="tag">${escapeHtml(it.sources[0])}${it.sources.length>1?'…':''}</div>` : '';
      return `
        <article class="card${catClass}" data-id="${escapeHtml(it.id)}" data-name="${escapeHtml(it.name)}">
          <h3 class="drug-name">💊 ${escapeHtml(it.name || '(ไม่มีชื่อ)')}</h3>
          ${it.generic ? `<div class="generic">(${escapeHtml(it.generic)})</div>`:''}
          <div class="meta">
            ${it.category ? `<span class="pill">หมวด: ${escapeHtml(it.category)}</span>`:''}
            ${it.updatedAt ? `<span class="pill">อัปเดต: ${escapeHtml(it.updatedAt)}</span>`:''}
          </div>
          <div class="excerpt">${escapeHtml(excerpt)}${excerpt.length>=180?'…':''}</div>
          <div class="tags">${srcs}</div>
          <button class="btn" onclick="openModal('${encodeURIComponent(it.id)}','${encodeURIComponent(it.name)}')">ดูรายละเอียด</button>
        </article>
      `;
    }).join('');
  }
  document.getElementById('pageInfo').textContent = `หน้า ${page} / ${totalPages}`;
  document.getElementById('prevBtn').disabled = page<=1;
  document.getElementById('nextBtn').disabled = page>=totalPages;
}

/** =============== Modal + Scroll Lock =============== **/
let scrollY = 0;
function lockBody(){
  scrollY = window.scrollY || document.documentElement.scrollTop;
  document.body.classList.add('no-scroll');
  document.body.style.position = 'fixed';
  document.body.style.top = `-${scrollY}px`;
  document.body.style.left = '0';
  document.body.style.right = '0';
  document.getElementById('mainContent').setAttribute('inert','');
}
function unlockBody(){
  document.body.classList.remove('no-scroll');
  document.body.style.position = '';
  document.body.style.top = '';
  document.body.style.left = '';
  document.body.style.right = '';
  window.scrollTo(0, scrollY);
  document.getElementById('mainContent').removeAttribute('inert');
}

function openModal(encodedId, encodedName){
  const id = decodeURIComponent(encodedId || '');
  const name = decodeURIComponent(encodedName || '');
  const it = raw.find(x=> (x.id && x.id===id) || (x.name===name)) || {};
  document.getElementById('mTitle').textContent = it.name || '(ไม่มีชื่อ)';
  document.getElementById('mMeta').innerHTML = `
    ${it.category ? `<span class="pill">หมวด: ${escapeHtml(it.category)}</span>`:''}
    ${it.caution ? `<span class="pill" style="border-color:#fca5a5; background:#fff1f2; color:#991b1b;">คำเตือน: ${escapeHtml(it.caution)}</span>`:''}
  `;
  document.getElementById('mContent').innerHTML = it.descHtml || '';
  const srcs = (it.sources||[]).map(s=>`<a href="${escapeHtml(s)}" target="_blank" rel="noopener nofollow">${escapeHtml(s)}</a>`).join('<br>');
  document.getElementById('mSources').innerHTML = srcs ? `<strong>แหล่งอ้างอิง:</strong><br>${srcs}` : '';

  document.getElementById('modalBackdrop').classList.add('show');
  lockBody();
}
function closeModal(){
  document.getElementById('modalBackdrop').classList.remove('show');
  unlockBody();
}
document.getElementById('closeModal').addEventListener('click', closeModal);
document.getElementById('modalBackdrop').addEventListener('click', (e)=>{ if(e.target.id==='modalBackdrop') closeModal(); });
document.addEventListener('keydown', (e)=>{ if(e.key==='Escape' && document.getElementById('modalBackdrop').classList.contains('show')) closeModal(); });

/** =============== Pager / Search =============== **/
document.getElementById('prevBtn').addEventListener('click', ()=>{ page=Math.max(1,page-1); renderPage(); });
document.getElementById('nextBtn').addEventListener('click', ()=>{ page=page+1; renderPage(); });

function applySearch(){
  const q = document.getElementById('q').value.trim().toLowerCase();
  const category = document.getElementById('cat').value.trim().toLowerCase();

  view = raw.filter(it=>{
    const hitQ = !q || [
      it.name, it.generic, stripHtml(it.descHtml||''), it.caution, (it.sources||[]).join(' ')
    ].join(' | ').toLowerCase().includes(q);
    const hitCat = !category || (String(it.category||'').toLowerCase() === category);
    return hitQ && hitCat;
  });
  page = 1;
  renderPage();
}
document.getElementById('searchBtn').addEventListener('click', applySearch);
document.getElementById('clearBtn').addEventListener('click', ()=>{
  document.getElementById('q').value=''; document.getElementById('cat').value='';
  view=raw.slice(0); page=1; renderPage();
});
document.getElementById('q').addEventListener('keydown', e=>{ if(e.key==='Enter') applySearch(); });
document.getElementById('cat').addEventListener('change', applySearch);

/** =============== Init =============== **/
(async function init(){
  // skeleton
  document.getElementById('grid').innerHTML = Array.from({length:6}).map(()=>`
    <div class="card">
      <div class="skeleton" style="height:18px; width:70%; border-radius:8px"></div>
      <div class="skeleton" style="height:10px; width:50%; border-radius:8px"></div>
      <div class="skeleton" style="height:70px; border-radius:12px"></div>
      <div class="skeleton" style="height:28px; width:120px; border-radius:10px"></div>
    </div>
  `).join('');

  try{
    raw = await fetchData();
    view = raw.slice(0);
    renderPage();
  }catch(e){
    document.getElementById('grid').innerHTML =
      `<div style="grid-column:1/-1; text-align:center; padding:24px; color:#b91c1c">
        เกิดข้อผิดพลาดในการโหลดข้อมูล: ${escapeHtml(e.message||String(e))}
      </div>`;
  }
})();
</script>

</body>
</html>