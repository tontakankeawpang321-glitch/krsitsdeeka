<!doctype html>
<html lang="th">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover"/>
<title>คลังคีย์ลัดออนไลน์ – ค้นหา/กรอง/ดูแบบไดอะล็อก</title>

<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@300;400;600;700&display=swap" rel="stylesheet">

<style>
  :root{
    --bg:#fbfbfe; --paper:#ffffff; --ink:#0f172a; --muted:#6b7280; --line:#e5e7eb;
    --brand:#2563eb; --brand-ink:#ffffff; --accent:#22c55e; --warn:#f59e0b;
    --radius:16px; --shadow:0 12px 30px -14px rgba(0,0,0,.25);
    --chip:#eff6ff; --chip-ink:#1d4ed8;
  }
  *{box-sizing:border-box}
  html,body{margin:0; font-family:"Sarabun",system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans Thai",Arial,sans-serif; color:var(--ink); background:linear-gradient(180deg,#f7f9ff,#fff)}
  a{color:inherit}

  .wrap{max-width:1100px; margin:0 auto; padding:20px 16px 80px}
  header{display:flex; gap:14px; align-items:center; flex-wrap:wrap; margin:8px 0 12px}
  header h1{font-size:22px; font-weight:700; margin:0}
  header .sub{color:var(--muted); font-size:14px}

  .toolbar{
    position:sticky; top:0; z-index:10;
    backdrop-filter:saturate(180%) blur(6px);
    background:rgba(255,255,255,.85); border-bottom:1px solid var(--line);
    padding:10px 0 12px; margin:4px 0 16px;
  }
  .searchbar{
    display:flex; gap:10px; align-items:center; flex-wrap:wrap;
  }
  .searchbar input{
    flex:1; min-width:220px; padding:12px 14px; border:1px solid var(--line); border-radius:12px;
    background:#fff; outline:none; font-size:14px;
  }
  .searchbar input:focus{border-color:#bfdbfe; box-shadow:0 0 0 4px rgba(59,130,246,.15)}
  .counter{font-size:13px; color:var(--muted)}
  .btn-clear{
    appearance:none; border:1px solid var(--line); background:#fff; color:#111827; padding:10px 12px; font-size:13px; border-radius:12px; cursor:pointer;
  }

  .chips{display:flex; gap:8px; flex-wrap:wrap; margin-top:10px}
  .chip{
    background:var(--chip); color:var(--chip-ink); border:1px solid #dbeafe;
    padding:8px 12px; border-radius:999px; font-size:13px; cursor:pointer; user-select:none;
    transition:.15s transform ease;
  }
  .chip.active{background:#1d4ed8; color:#fff; border-color:#1d4ed8}
  .chip:hover{transform:translateY(-1px)}

  .grid{
    display:grid; gap:12px;
    grid-template-columns:repeat(1,minmax(0,1fr));
  }
  @media(min-width:560px){ .grid{grid-template-columns:repeat(2,1fr)} }
  @media(min-width:920px){ .grid{grid-template-columns:repeat(3,1fr)} }

  .card{
    background:var(--paper); border:1px solid var(--line); border-radius:var(--radius); box-shadow:var(--shadow);
    padding:14px; display:flex; flex-direction:column; gap:10px; min-height:180px;
  }
  .title{display:flex; align-items:flex-start; gap:10px}
  .avatar{
    width:44px; height:44px; flex:0 0 44px; border-radius:12px; background:linear-gradient(135deg,#e0e7ff,#f0fdf4);
    display:grid; place-items:center; font-weight:700; color:#1f2937; border:1px solid var(--line);
  }
  .meta{flex:1}
  .meta h3{margin:0; font-size:16px}
  .badge{display:inline-block; margin-top:4px; font-size:12px; color:var(--muted)}
  .desc{color:#374151; font-size:13px; line-height:1.5}

  .actions{margin-top:auto; display:flex; gap:8px; flex-wrap:wrap}
  .btn{
    appearance:none; border:1px solid var(--line); background:#fff; color:#111827; padding:10px 12px; font-size:13px; border-radius:12px; cursor:pointer;
  }
  .btn.primary{background:var(--brand); color:var(--brand-ink); border-color:#1e40af}
  .btn:active{transform:translateY(1px)}

  /* dialog */
  dialog{
    border:none; border-radius:18px; width:min(920px,calc(100% - 24px)); padding:0; overflow:hidden; box-shadow:0 40px 60px -24px rgba(0,0,0,.45);
  }
  .dlg-head{
    padding:16px 18px; background:linear-gradient(135deg,#1e40af,#2563eb); color:#fff; display:flex; align-items:center; gap:12px;
  }
  .dlg-head .logo{width:38px; height:38px; border-radius:10px; background:rgba(255,255,255,.15); display:grid; place-items:center; font-weight:700}
  .dlg-head .tt{flex:1}
  .dlg-head h2{margin:0; font-size:18px}
  .dlg-body{padding:14px 18px 18px; background:#fff; max-height:70vh; overflow:auto;}
  .dlg-tools{display:flex; gap:10px; align-items:center; flex-wrap:wrap; margin-bottom:8px}
  .dlg-tools input{
    flex:1; min-width:200px; padding:10px 12px; border:1px solid var(--line); border-radius:10px; outline:none;
  }
  .tbl{width:100%; border-collapse:collapse; font-size:14px}
  .tbl th,.tbl td{border-bottom:1px solid #edf2f7; padding:9px 8px; text-align:left; vertical-align:top}
  .tbl th{background:#f8fafc; color:#334155}
  .kbd{font-family:ui-monospace,Menlo,Consolas,monospace; font-size:13px; background:#0f172a; color:#fff; padding:4px 7px; border-radius:8px; white-space:pre}
  .dlg-foot{display:flex; justify-content:space-between; align-items:center; padding:12px 18px; background:#fafafa; border-top:1px solid var(--line)}
  .hint{font-size:12px; color:#6b7280}
  .x{appearance:none; border:none; background:transparent; font-size:22px; line-height:1; color:#fff; cursor:pointer}

  .empty{padding:20px 10px; color:var(--muted)}

  /* เว้นที่บน-ล่างให้ศูนย์กลางบนมือถือ */
  .mobile-spacer{height:12vh}

  /* ล็อกสกรอลล์หน้าเมื่อเปิดไดอะล็อก */
  body.modal-open{
    overflow:hidden;
    position:fixed; width:100%;
  }
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>คลังคีย์ลัดออนไลน์</h1>
      <span class="sub">คลิกการ์ดเพื่อดูคีย์ลัดในไดอะล็อก · มีค้นหา + กรองหมวด</span>
    </header>

    <div class="toolbar">
      <div class="searchbar">
        <input id="q" type="search" placeholder="ค้นหาชื่อโปรแกรม หรือชื่อคำสั่ง (เช่น copy, duplicate, render, pivot)…"/>
        <button id="clearSearch" class="btn-clear" title="ล้างคำค้น">ล้าง</button>
        <span class="counter" id="counter">—</span>
      </div>
      <div class="chips" id="chips"></div>
    </div>

    <div class="grid" id="grid"></div>
  </div>

<script>
/* ===========================
   1) ข้อมูล (หมวด + โปรแกรม + คีย์ลัด)
   =========================== */
const DATA = [
/* (ข้อมูลเหมือนเดิมทั้งหมด — ไม่ถูกแก้) */
];

/* ====== 2) ชิปหมวด (จำกัด 3 อัน) + การ์ดโปรแกรม ====== */
const chipsEl = document.getElementById('chips');
const gridEl  = document.getElementById('grid');
const qEl     = document.getElementById('q');
const counterEl = document.getElementById('counter');
const clearBtn = document.getElementById('clearSearch');

let flat = [];
const limitedCats = DATA.map(g=>g.cat).slice(0,3);
let activeCatIndex = -1;

window.setCategoryIndex = function(idx){
  if (typeof idx !== 'number') return;
  if (idx < -1) idx = -1;
  if (idx > limitedCats.length-1) idx = limitedCats.length-1;
  activeCatIndex = idx;
  renderChips();
  render();
};
window.getCategoryIndex = function(){ return activeCatIndex; };

let dlg = null, dlgBody=null, dlgTitle=null, dlgFilter=null, tbody=null, emptyRow=null;
let currentItem = null;
let savedScrollY = 0;

function flatten(){
  flat = [];
  for(const group of DATA){
    for(const it of group.items){
      flat.push({
        cat: group.cat, name: it.name, url: it.url || '#', desc: it.desc || '',
        shortcuts: it.shortcuts || []
      });
    }
  }
}
function renderChips(){
  chipsEl.innerHTML = '';
  limitedCats.forEach((cat, i)=>{
    const b = document.createElement('button');
    b.className = 'chip' + (i===activeCatIndex ? ' active':'');
    b.textContent = cat;
    b.onclick = ()=>{ activeCatIndex = i; renderChips(); render(); };
    chipsEl.appendChild(b);
  });
}
function match(item, term){
  if(!term) return true;
  term = term.toLowerCase();
  if((item.name+' '+item.cat+' '+item.desc).toLowerCase().includes(term)) return true;
  for(const s of item.shortcuts){
    if((s.key+' '+s.action).toLowerCase().includes(term)) return true;
  }
  return false;
}
function render(){
  const term = qEl.value.trim().toLowerCase();
  chipsEl.style.display = term ? 'none' : '';

  const list = flat.filter(it=>{
    const okCat = (activeCatIndex===-1) ? true : (it.cat === limitedCats[activeCatIndex]);
    return okCat && match(it, term);
  });
  gridEl.innerHTML = '';
  list.forEach(it=>{
    const card = document.createElement('div');
    card.className = 'card';

    /* ========== เวอร์ชันแก้แล้ว → ไม่มีลิงก์เว็บ ========== */
    card.innerHTML = `
      <div class="title">
        <div class="avatar">${it.name.split(' ').map(w=>w[0]).join('').substring(0,3)}</div>
        <div class="meta">
          <h3>${it.name}</h3>
          <span class="badge">${it.cat}</span>
        </div>
      </div>
      <div class="desc">${it.desc || ''}</div>
      <div class="actions">
        <button class="btn primary">ดูคีย์ลัด</button>
      </div>
    `;
    /* ======================================================= */

    card.querySelector('.btn.primary').onclick = ()=> openDlg(it);
    gridEl.appendChild(card);
  });

  const catLabel = (activeCatIndex===-1) ? 'ทั้งหมด' : limitedCats[activeCatIndex];
  counterEl.textContent = `${list.length} รายการ${term?` · ค้นหา "${qEl.value.trim()}"`:''}${catLabel!=='ทั้งหมด'?` · หมวด ${catLabel}`:''}`;

  if(list.length===0){
    const empty = document.createElement('div');
    empty.className = 'empty';
    empty.textContent = 'ไม่พบผลลัพธ์ที่ตรงกับเงื่อนไข';
    gridEl.appendChild(empty);
  }
}

function debounce(fn, ms=200){ let t; return (...a)=>{ clearTimeout(t); t=setTimeout(()=>fn(...a), ms); }; }

/* ====== 3) Dialog ====== */
function createDialog(){
  if (dlg) return;
  dlg = document.createElement('dialog');
  dlg.innerHTML = `
    <div class="dlg-head">
      <div class="logo" id="dlgLogo">⌨️</div>
      <div class="tt"><h2 id="dlgTitle">—</h2></div>
      <button class="x" id="dlgClose" aria-label="Close">×</button>
    </div>
    <div class="dlg-body" id="dlgBody">
      <div class="mobile-spacer"></div>
      <div class="dlg-tools">
        <input id="dlgFilter" placeholder="ค้นหาในคีย์ลัดของโปรแกรมนี้…">
        <button class="btn" id="copyBtn">คัดลอกเป็นข้อความ</button>
      </div>
      <div class="table-wrap">
        <table class="tbl">
          <thead><tr><th style="width:33%">ปุ่ม</th><th>คำสั่ง / รายละเอียด</th></tr></thead>
          <tbody id="tbody"></tbody>
        </table>
        <div class="empty" id="emptyRow" style="display:none">ไม่พบคีย์ลัดที่ตรงกับคำค้น</div>
      </div>
      <div class="mobile-spacer"></div>
      <div class="dlg-foot">
        <span class="hint">Tip: กด <span class="kbd">Esc</span> เพื่อปิดไดอะล็อก</span>
        <div></div>
      </div>
    </div>
  `;
  document.body.appendChild(dlg);

  dlgBody   = dlg.querySelector('#dlgBody');
  dlgTitle  = dlg.querySelector('#dlgTitle');
  dlgFilter = dlg.querySelector('#dlgFilter');
  tbody     = dlg.querySelector('#tbody');
  emptyRow  = dlg.querySelector('#emptyRow');

  dlg.querySelector('#dlgClose').addEventListener('click', closeDlg);
  dlg.querySelector('#copyBtn').addEventListener('click', copyTable);
  dlgFilter.addEventListener('input', debounce(()=>{ if(currentItem) buildTable(currentItem.shortcuts, dlgFilter.value); }, 120));

  dlg.addEventListener('close', cleanupDialog);
  dlg.addEventListener('cancel', (e)=>{ e.preventDefault(); closeDlg(); });
}

function openDlg(item){
  createDialog();
  currentItem = item;
  dlg.querySelector('#dlgLogo').textContent = (item.name[0]||'⌨️').toUpperCase();
  dlgTitle.textContent = item.name;
  dlgFilter.value='';
  buildTable(item.shortcuts, '');

  (typeof dlg.showModal === 'function') ? dlg.showModal() : dlg.setAttribute('open','');
}
function closeDlg(){
  if (!dlg) return;
  if (dlg.open) dlg.close();
  else cleanupDialog();
}
function cleanupDialog(){
  if (!dlg) return;
  dlg.remove();
  dlg = dlgBody = dlgTitle = dlgFilter = tbody = emptyRow = null;
  currentItem = null;
}

function buildTable(rows, term){
  tbody.innerHTML='';
  const q = (term||'').toLowerCase();
  const matched = rows.filter(r => (r.key+' '+r.action).toLowerCase().includes(q));
  matched.forEach(r=>{
    const tr = document.createElement('tr');
    tr.innerHTML = `<td><span class="kbd">${escapeHtml(r.key)}</span></td><td>${escapeHtml(r.action)}</td>`;
    tbody.appendChild(tr);
  });
  emptyRow.style.display = matched.length? 'none':'block';
}

function copyTable(){
  if(!currentItem) return;
  const q = (dlgFilter.value||'').toLowerCase();
  const matched = currentItem.shortcuts.filter(r => (r.key+' '+r.action).toLowerCase().includes(q));
  const text = `คีย์ลัด: ${currentItem.name}\n` + matched.map(r=>`${r.key} — ${r.action}`).join('\n');
  navigator.clipboard.writeText(text).then(()=> alert('คัดลอกแล้ว!'));
}

function escapeHtml(s){ return (s||'').replace(/[&<>"']/g, m => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m])); }

function init(){
  flatten();
  renderChips();
  render();
  qEl.addEventListener('input', debounce(render, 120));
  clearBtn.addEventListener('click', ()=>{ qEl.value=''; render(); qEl.focus(); });
}
init();
</script>
</body>
</html>
